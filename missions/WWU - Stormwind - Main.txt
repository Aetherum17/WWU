#--------------------------------------
# Stormwind
#--------------------------------------
STW_stormwind_column_1 = {
	slot = 1
	generic = no
	ai = yes
    has_country_shield = yes
    
	potential = {
		tag = STW
		has_country_flag = stormwind_one_finished
	}

	STW_stormwind_army_reform = {
		icon = mission_titan_spirits
		position = 1

		trigger = {
			army_size = 50
			army_tradition = 50
			army_professionalism = 0.25
		}

		effect = {
			country_event = { id = wwu_mission_stw_main.1 }
		}
	}

	STW_stormwind_order_of_knights = {
		icon = mission_titan_spirits
		position = 2

		required_missions = { STW_stormwind_army_reform }

		trigger = {
			army_professionalism = 0.5
			army_tradition = 75
			cavalry_fraction = 0.2
			has_global_modifier_value = {
				which = cavalry_power
				value = 0.15
			}
		}

		effect = {
			custom_tooltip = SPECIALIST_BROTHERHOOD_TT
			set_country_flag = stormwind_avalable_horsebrothers

			custom_tooltip = ENABLE_PRIVILIEGE_LORDS_ON_HORSES_TT
			set_country_flag = stormwind_enable_privilige_lords_on_horses

			add_country_modifier = {
				name = mission_cavalry_expansion
				duration = -1
			}
		}
	}

    STW_stormwind_faith_and_magic = {
        icon = mission_titan_spirits
        position = 3

        required_missions = { STW_stormwind_order_of_knights }

        trigger = {
			2204 = {
				has_great_project = {
					type = gp_cathedral_of_light
					tier = 2
				}
			}
			2205 = {
				has_great_project = {
					type = gp_stormwind_mage_tower
					tier = 2
				}
			}
            OR = {
                innovativeness = 75
                religious_unity = 0.9
            }
        }

        provinces_to_highlight = {
            OR = {
                province_id = 2205
                province_id = 2204
            }
        }

        effect = {
            country_event = { id = wwu_mission_stw_main.2 }
        }
    }
}

STW_stormwind_column_2 = {
	slot = 2
	generic = no
	ai = yes
    has_country_shield = yes
    
	potential = {
		tag = STW
		has_country_flag = stormwind_one_finished
	}
    


}

STW_stormwind_column_3 = {
	slot = 3
	generic = no
	ai = yes
    has_country_shield = yes
    
	potential = {
		tag = STW
		has_country_flag = stormwind_one_finished
	}

	STW_stormwind_m_reestablish_order = { 
		icon = mission_paladin_empowered_seals_righteous
        position = 1

		trigger = {
			WST = {
				OR = {
					NOT = { exists = WST}
					OR = {
						has_opinion = {
							who = STW
							value = 175
						}
						NOT = { liberty_desire = 20 }
					}
				}
			}
			DKS = {
				OR = {
					NOT = { exists = DKS}
					OR = {
						has_opinion = {
							who = STW
							value = 175
						}
						NOT = { liberty_desire = 20 }
					}
				}
			}
			RRG = {
				OR = {
					NOT = { exists = RRG}
					OR = {
						has_opinion = {
							who = STW
							value = 175
						}
						NOT = { liberty_desire = 20 }
					}
				}
			}
			stability = 1
			legitimacy = 90
		}

		provinces_to_highlight = {
			OR = {
				is_capital_of = RRG
				is_capital_of = WST
				is_capital_of = DKS
			}
		}

		effect = {
			add_country_modifier = {
				name = mission_satisfied_subjects
				duration = -1
			}

			add_adm_power = 100
			add_dip_power = 100
		}
	}

	STW_stormwind_m_stormwind_ironforge_pact = {
		icon = mission_titan_spirits
		position = 2
		
		required_missions = { STW_stormwind_m_reestablish_order}

		trigger = {
			OR = {
				NOT = { exists = A29 }
				A29 = {
					exists = yes
					has_opinion = {
						who = STW
						value = 180
					}
				}
			}
		}

		provinces_to_highlight = {
			OR = {
				is_capital_of = A29
				area = area_ironforge
			}
		}

		effect = {
			if = {
				limit = {
					exists = A29
				}
				create_alliance = A29
				add_historical_friend = A29
				add_accepted_culture = culture_ironforge
				A29 = {
					add_historical_friend = STW
					add_accepted_culture = culture_stormwindian
				}
			}
			else = {
				area_ironforge = {
					add_permanent_claim = ROOT
				}
				add_mil_power = 100
			}
		}
	}

	STW_stormwind_m_gnomish_allies = {
		icon = mission_titan_spirits
		position = 3

		required_missions = { STW_stormwind_m_stormwind_ironforge_pact }

		trigger = {
			OR = {
				NOT = {exists = A32 }
				A32 = {
					exists = yes
					has_opinion = {
						who = STW
						value = 165
					}
				}
			}
		}

		provinces_to_highlight = {
			OR = {
				is_capital_of = A32
				area = area_gnomeregan
			}
		}

		effect = {
			if = {
				limit = {
					exists = A32
				}
				create_alliance = A32
				add_historical_friend = A32
				add_accepted_culture = culture_gnome
				add_country_modifier = {
					name = mission_gnomish_guests
					duration = -1
				}
				A32 = {
					add_historical_friend = STW
					add_accepted_culture = culture_stormwindian
					add_country_modifier = {
						name = mission_stormwindian_engineers
						duration = -1
					}
				}
			}
			else = {
				area_ironforge = {
					add_permanent_claim = ROOT
				}
				add_mil_power = 100
			}
		}
	}  
}

STW_stormwind_column_4 = { 
	slot = 4
	generic = no
	ai = yes
    has_country_shield = yes
    
	potential = {
		tag = STW
		has_country_flag = stormwind_one_finished
	}

	STW_stormwind_m_secure_stranghlethorn = {
		icon = mission_titan_spirits
		position = 2

		required_missions = { STW_stormwind_m_reestablish_order }

		trigger = {
			owns_core_province = 1996

			1996 = {
				has_fort_building_trigger = yes
				base_manpower = 4
			}
		}

		provinces_to_highlight = {
			province_id = 1996
		}

		effect = {
			1996 = {
				change_culture = ROOT
				add_province_modifier = {
					name = mission_stranglethorn_pass
					duration = -1
				}
			}
			country_event = { id = wwu_mission_stw_main.3 }
		}
	}

	STW_stormwind_m_kurzen_expedition = {
		icon = mission_titan_spirits
		position = 3

		required_missions = { STW_stormwind_m_secure_stranghlethorn }

		trigger = {
			area_kurzen_encampment = {
				country_or_non_sovereign_subject_holds = ROOT
			}
		}

		provinces_to_highlight = {
			area = area_kurzen_encampment
		}

		effect = {
			area_fort_livingston = {
				add_permanent_claim = ROOT
				add_permanent_claim = F28
			}
			area_gurubashi_arena = {
				add_permanent_claim = ROOT
				add_permanent_claim = F28
			}
		}
	}

	STW_stormwind_m_fort_livingstone = {
		icon = mission_titan_spirits
		position = 4

		required_missions = { STW_stormwind_m_kurzen_expedition }

		trigger = {
			548 = {
				base_tax = 3
				base_production = 3
				base_manpower = 6
				has_fort_building_trigger = yes
				OR = {
					has_building = wow_tower_1
					has_building = wow_tower_2
					has_building = wow_tower_3
					has_building = wow_arsenal_1
					has_building = wow_arsenal_2
					has_building = wow_arsenal_3
				}
			}
		}

		provinces_to_highlight = {
			province_id = 548
		}

		effect = {
			area_kalai = {
				add_permanent_claim = ROOT
			}
			area_upper_troll_ruins = {
				add_permanent_claim = ROOT
			}
			area_lower_troll_ruins = {
				add_permanent_claim = ROOT
			}
			area_zulakman = {
				add_permanent_claim = ROOT
			}

			area_fort_livingston = {
				change_culture = culture_stormwindian
			}

			define_advisor = {
				type = fortification_expert
				name = "Livingstone Marshal"
				skill = 2
				localtion = 548
				discount = yes
				culture = culture_stormwindian
				religion = holy_light
			}

			custom_tooltip = SPECIALIST_LIVINGSTONE_TT
			set_country_flag = stormwind_avalable_livingstone

		}
	}

	STW_stormwind_m_into_the_jungle = {
		icon = mission_titan_spirits
		position = 5

		required_missions = { STW_stormwind_m_fort_livingstone }

		trigger = {
			area_kalai = {
				country_or_non_sovereign_subject_holds = ROOT
			}
			area_upper_troll_ruins = {
				country_or_non_sovereign_subject_holds = ROOT
			}
		}

		provinces_to_highlight = {
			OR = {
				area = area_kalai
				area = area_upper_troll_ruins
			}
		}

		effect = {
			add_prestige = 10
			add_years_of_income = 1

			area_kalai = {
				change_culture = culture_stormwindian
				change_religion = ROOT
			}
		}
	}

	STW_stormwind_m_securing_southern_stranglethorn = {
		icon = mission_titan_spirits
		position = 6

		required_missions = { STW_stormwind_m_into_the_jungle }

		trigger = {
			area_lower_troll_ruins = {
				country_or_non_sovereign_subject_holds = ROOT
			}
		}

		provinces_to_highlight = {
			area = area_lower_troll_ruins
		}

		effect = {
			add_adm_power = 75
			add_mil_power = 75
			add_treasury = 250

			if = {
				limit = {
					exists = A83
				}
				add_casus_belli = {
					target = A83
					type = cb_vassalize_mission
					months = 60
				}
			}
		}
	}

	STW_stormwind_m_control_booty_bay = {
		icon = mission_titan_spirits
		position = 7

		required_missions = { STW_stormwind_m_securing_southern_stranglethorn }

		trigger = {
			area_booty_bay = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			area_jaguero_isle = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			A83 = {
				OR = {
					NOT = { exists = A83}
					is_subject_of = ROOT
				}
			}
		}

		provinces_to_highlight = {
			OR = {
				area = area_booty_bay
				area = area_jaguero_isle
			}
		}

		effect = {
			if = {
				limit = {
					A83 = {
						is_subject_of = ROOT
					}
				}
				add_country_modifier = {
					name = mission_booty_bay_protection
					duration = -1
				}
			}

			area_booty_bay = {
				add_province_modifier = {
					name = mission_stranglethorn_trade
					duration = -1
				}
			}

			area_jaguero_isle = {
				add_province_modifier = {
					name = mission_stranglethorn_trade
					duration = -1
				}
			}

			area_mistvale = {
				add_province_modifier = {
					name = mission_stranglethorn_trade
					duration = -1
				}
			}

			area_lower_troll_ruins = {
				add_province_modifier = {
					name = mission_stranglethorn_trade
					duration = -1
				}
			}
		}
	}  
}

STW_stormwind_column_5 = {
	slot = 5
	generic = no
	ai = yes
    has_country_shield = yes
    
	potential = {
		tag = STW
		has_country_flag = stormwind_one_finished
	}

	STW_stormwind_m_building_the_fleet = {
		icon = mission_titan_spirits
		position = 1

		trigger = {
			navy_size = 40
			num_of_admirals = 1
			sailors_percentage = 0.9
		}

		effect = {
			add_country_modifier = {
				name = mission_stw_contstruct_fleet
				duration = 9125
			}
			2141 = {
				add_building = wow_shipyard_3
				add_building = wow_dockyard_3
				add_base_production = 3
			}
		}
	}

	STW_stormwind_m_mercantile_connections = {
		icon = mission_titan_spirits
		position = 2

		required_missions = { STW_stormwind_m_building_the_fleet }

		trigger = {
			num_of_light_ship = 30

			2202 = {
				is_strongest_trade_power = ROOT
			}
			596 = {
				is_strongest_trade_power = ROOT
			}
			1021 = {
				is_strongest_trade_power = ROOT
			}
			737 = {
				is_strongest_trade_power = ROOT
			}
			996 = {
				is_strongest_trade_power = ROOT
			}
		}

		provinces_to_highlight = {
			OR = {
				province_id = 2202
				province_id = 596
				province_id = 1021
				province_id = 737
				province_id = 996
			}
		}

		effect = {
			add_country_modifier = {
				name = mission_stormwind_mercentile
				duration = -1
			}

			add_country_flag = stormwind_mercentile_unlock
		}
	}

	STW_stormwind_m_stormwind_armada = {
		icon = mission_titan_spirits
		position = 3

		required_missions = { STW_stormwind_m_mercantile_connections }

		trigger = {
			num_of_heavy_ship = 50
			navy_size_percentage = 0.9
			num_of_admirals = 3
		}

		effect = {
			add_country_modifier = {
				name = mission_kings_fleet
				duration = -1
			}

			add_country_flag = stormwind_grand_armada_unlock
		}
	}

	STW_stormwind_m_balor_naval_command = {
		icon = mission_titan_spirits
		position = 4

		required_missions = { STW_stormwind_m_stormwind_armada }

		trigger = {
			4111 = {
				base_manpower = 8
				base_production = 8
				OR = {
					has_building = wow_dockyard_1
					has_building = wow_dockyard_2
					has_building = wow_dockyard_3
				}
				OR = {
					has_building = wow_shipyard_1
					has_building = wow_shipyard_2
					has_building = wow_shipyard_3
				}
				OR = {
					has_building = wow_tower_1
					has_building = wow_tower_2
					has_building = wow_tower_3
				}
				has_fort_building_trigger = yes
				unrest = 0
			}
		}

		provinces_to_highlight = {
			province_id = 4111
		}

		effect = {
			country_event = { id = wwu_mission_stw_main.5 }
		}
	} 
}