#---------------------------------------
# Invasion
#---------------------------------------
start_invasion = {
	category = influence
	
	alert_index = 40
	alert_tooltip = start_invasion_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        # Capital is in other-worldly plane
        capital_scope = {
            OR = {
                # Elemental Plane
                continent = continent_skywall
                continent = continent_deepholm
                continent = continent_abyssal_maw
                continent = continent_firelands
                
                # Argus
                continent = continent_argus
            }
        }
        
        if = {
            limit = {
                capital_scope = {
                    continent = continent_argus
                }
            }
            # Culture is appropirate
            OR = {
                culture_group = culture_group_ethereal
                culture_group = culture_group_demonic
                primary_culture = culture_lightforged
            }
        }
        
        # Target has atleast 2 provinces
        FROM = {
            num_of_cities = 2
            
            # Target is not in the same plane as ROOT
            if = {
                limit = {
                    ROOT = {
                        capital_scope = {
                            continent = continent_skywall
                        }
                    }
                }
                NOT = {
                    capital_scope = {
                        continent = continent_skywall
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        capital_scope = {
                            continent = continent_deepholm
                        }
                    }
                }
                NOT = {
                    capital_scope = {
                        continent = continent_deepholm
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        capital_scope = {
                            continent = continent_abyssal_maw
                        }
                    }
                }
                NOT = {
                    capital_scope = {
                        continent = continent_abyssal_maw
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        capital_scope = {
                            continent = continent_firelands
                        }
                    }
                }
                NOT = {
                    capital_scope = {
                        continent = continent_firelands
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        capital_scope = {
                            continent = continent_argus
                        }
                    }
                }
                NOT = {
                    capital_scope = {
                        continent = continent_argus
                    }
                }
            }
        }
        
        # Not currently at war
        is_at_war = no
	}
	is_allowed = {
		is_at_war = no
        
        NOT = { has_country_modifier = invasion_action_cooldown }
        
        
        if = {
            limit = {
                OR = {
                    has_estate_privilege = estate_legion_invasion_preparations
                    has_estate_privilege = estate_abyssal_maw_invasion_preparation
                    has_estate_privilege = estate_firelands_invasion_preparation
                    has_estate_privilege = estate_deepholm_invasion_preparation
                    has_estate_privilege = estate_skywall_invasion_preparation
                }
            }
            if = {
                limit = {
                    FROM = {
                        total_development = 1000
                    }
                }
                mil_power = 400
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 750
                    }
                }
                mil_power = 300
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 500
                    }
                }
                mil_power = 200
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 250
                    }
                }
                mil_power = 100
            }
            else = {
                mil_power = 50
            }
        }
        else = {
            if = {
                limit = {
                    FROM = {
                        total_development = 1000
                    }
                }
                mil_power = 800
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 750
                    }
                }
                mil_power = 700
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 500
                    }
                }
                mil_power = 600
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 250
                    }
                }
                mil_power = 400
            }
            else = {
                mil_power = 200
            }
        }
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - start_invasion"
            }
        }
        
        if = {
            limit = {
                OR = {
                    has_estate_privilege = estate_legion_invasion_preparations
                    has_estate_privilege = estate_abyssal_maw_invasion_preparation
                    has_estate_privilege = estate_firelands_invasion_preparation
                    has_estate_privilege = estate_deepholm_invasion_preparation
                    has_estate_privilege = estate_skywall_invasion_preparation
                }
            }
            if = {
                limit = {
                    FROM = {
                        total_development = 1000
                    }
                }
                add_mil_power = -400
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 750
                    }
                }
                add_mil_power = -300
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 500
                    }
                }
                add_mil_power = -200
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 250
                    }
                }
                add_mil_power = -100
            }
            else = {
                add_mil_power = -50
            }
        }
        else = {
            if = {
                limit = {
                    FROM = {
                        total_development = 1000
                    }
                }
                add_mil_power = -800
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 750
                    }
                }
                add_mil_power = -700
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 500
                    }
                }
                add_mil_power = -600
            }
            else_if = {
                limit = {
                    FROM = {
                        total_development = 250
                    }
                }
                add_mil_power = -400
            }
            else = {
                add_mil_power = -200
            }
        }
        
        declare_war_with_cb = {
            who = FROM
            casus_belli = cb_invasion
        }
        
		FROM = {
            random_owned_province = {
                change_controller = ROOT
                add_core = ROOT
                
                # 10
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                artillery = ROOT
                artillery = ROOT
                
                if = {
                    limit = {
                        ROOT = {
                            OR = {
                                has_estate_privilege = estate_legion_merciless_invasion
                                has_estate_privilege = estate_abyssal_maw_overwhelming_force
                                has_estate_privilege = estate_firelands_overwhelming_force
                                has_estate_privilege = estate_deepholm_overwhelming_force
                                has_estate_privilege = estate_skywall_overwhelming_force
                            }
                        }
                    }
                    
                    # 10
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    cavalry = ROOT
                    cavalry = ROOT
                    cavalry = ROOT
                    artillery = ROOT
                    artillery = ROOT
                    
                    # 10
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    infantry = ROOT
                    cavalry = ROOT
                    cavalry = ROOT
                    cavalry = ROOT
                    artillery = ROOT
                    artillery = ROOT
                }
            }
            
            hidden_effect = { set_country_flag = is_invaded }
        }
        
        hidden_effect = { set_country_flag = is_invading }
        
        add_country_modifier = {
            name = invasion_action_cooldown
            duration = 3650
            hidden = yes
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {
        # AI will not do it with these tags
        NOT = { tag = ARL }
        NOT = { tag = SDG }
        
		mil_power = 500
        
        # AI will only do it to other AI
        FROM = {
            ai = yes
        }
        
        # AI will only do it to weaker nations
        FROM = {
            NOT = { total_development = 250 }
        }
	}
}

#---------------------------------------
# Argus Invasion
#---------------------------------------
start_argus_invasion = {
	category = influence
	
	alert_index = 40
	alert_tooltip = start_argus_invasion_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        FROM = {
            num_of_cities = 2
            
            capital_scope = {
                continent = continent_argus
            }
            
            OR = {
                war_with = ROOT
                ROOT = { 
                    has_country_modifier = sargerite_keystone
                }
            }
        }
        
        # Not currently at war
        is_at_war = no
	}
	is_allowed = {
		is_at_war = no
        
        NOT = { has_country_modifier = invasion_action_cooldown }
        
        if = {
            limit = {
                FROM = {
                    total_development = 1000
                }
            }
            mil_power = 800
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 750
                }
            }
            mil_power = 700
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 500
                }
            }
            mil_power = 600
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 250
                }
            }
            mil_power = 400
        }
        else = {
            mil_power = 200
        }
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - start_argus_invasion"
            }
        }
        
        if = {
            limit = {
                FROM = {
                    total_development = 1000
                }
            }
            add_mil_power = -800
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 750
                }
            }
            add_mil_power = -700
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 500
                }
            }
            add_mil_power = -600
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 250
                }
            }
            add_mil_power = -400
        }
        else = {
            add_mil_power = -200
        }
        
        declare_war_with_cb = {
            who = FROM
            casus_belli = cb_invasion
        }
		FROM = {
            random_owned_province = {
                limit = {
                    continent = continent_argus
                }
                change_controller = ROOT
                add_core = ROOT
                
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                artillery = ROOT
                artillery = ROOT
            }
        }
        
        add_country_modifier = {
            name = invasion_action_cooldown
            duration = 3650
            hidden = yes
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {
		always = no
	}
}

#---------------------------------------
# Elemental Invasion
#---------------------------------------
start_elemental_invasion = {
	category = influence
	
	alert_index = 40
	alert_tooltip = start_elemental_invasion_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        FROM = {
            num_of_cities = 2
            
            capital_scope = {
                OR = {
                    continent = continent_skywall
                    continent = continent_deepholm
                    continent = continent_abyssal_maw
                    continent = continent_firelands
                }
            }
            
            OR = {
                war_with = ROOT
                ROOT = { 
                    has_country_modifier = elemental_riftstone
                }
            }
        }
        
        # Not currently at war
        is_at_war = no
	}
	is_allowed = {
		is_at_war = no
        
        NOT = { has_country_modifier = invasion_action_cooldown }
        
        if = {
            limit = {
                FROM = {
                    total_development = 1000
                }
            }
            mil_power = 800
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 750
                }
            }
            mil_power = 700
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 500
                }
            }
            mil_power = 600
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 250
                }
            }
            mil_power = 400
        }
        else = {
            mil_power = 200
        }
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - start_elemental_invasion"
            }
        }
        
        if = {
            limit = {
                FROM = {
                    total_development = 1000
                }
            }
            add_mil_power = -800
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 750
                }
            }
            add_mil_power = -700
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 500
                }
            }
            add_mil_power = -600
        }
        else_if = {
            limit = {
                FROM = {
                    total_development = 250
                }
            }
            add_mil_power = -400
        }
        else = {
            add_mil_power = -200
        }
        
        declare_war_with_cb = {
            who = FROM
            casus_belli = cb_invasion
        }
		FROM = {
            random_owned_province = {
                limit = {
                    OR = {
                        continent = continent_skywall
                        continent = continent_deepholm
                        continent = continent_abyssal_maw
                        continent = continent_firelands
                    }
                }
                change_controller = ROOT
                add_core = ROOT
                
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                infantry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                cavalry = ROOT
                artillery = ROOT
                artillery = ROOT
            }
        }
        
        add_country_modifier = {
            name = invasion_action_cooldown
            duration = 3650
            hidden = yes
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {
		always = no
	}
}

#---------------------------------------
# Teleport Army
#---------------------------------------
teleport_army = {
	category = influence
	
	alert_index = 40
	alert_tooltip = teleport_army_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        # Only available whilst at war with target
        war_with = FROM

        # Limitations
        ROOT = {
            OR = {
                # Capital is off-world
                capital_scope = {
                    OR = {
                        continent = continent_skywall
                        continent = continent_deepholm
                        continent = continent_abyssal_maw
                        continent = continent_firelands
                        continent = continent_argus
                    }
                }
                
                # Or being attacked by off-world nation
                FROM = {
                    capital_scope = {
                        OR = {
                            continent = continent_skywall
                            continent = continent_deepholm
                            continent = continent_abyssal_maw
                            continent = continent_firelands
                            continent = continent_argus
                        }
                    }
                }
                
                # Or is skilled spellcaster
                has_epic_aptitude = yes
            }
        }
	}
	is_allowed = {
        # Cooldown for teleport
        NOT = { has_country_modifier = portal_fatigue }
        
        # Teleport checks so the event is valid
        any_owned_province = {
            num_of_units_in_province = {
                who = ROOT
                amount = 1
            }
        }
        
        FROM = {
            any_owned_province = {
                NOT = {
                    num_of_units_in_province = {
                        who = ROOT
                        amount = 1
                    }
                }
            }
        }
        
        # Hostile portals take considerable resources to conjure
		mil_power = 100
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - teleport_army"
            }
        }
        
        add_mil_power = -100
        
        FROM = {
            save_event_target_as = hostile_country
        }
        country_event = { id = wwu_teleport_system.10 }
        
        if = {
            limit = {
                NOT = { has_estate_privilege = estate_invention_dimensional_ripper }
            }
            add_country_modifier = {
                name = portal_fatigue
                duration = 365
                hidden = yes
            }
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {  
        # Should reduce usage by the AI to a suitable level
        mil_power = 800
	}
}

#---------------------------------------
# Traverse Network (Azjol-Nerub variant of Teleport Army)
#---------------------------------------
traverse_network = {
	category = influence
	
	alert_index = 40
	alert_tooltip = traverse_network_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        # Only available whilst at war with target
        war_with = FROM

        # Limitations
        ROOT = {
            tag = P74 # Azjol-Nerub
        }
	}
	is_allowed = {
        # Cooldown for teleport
        NOT = { has_country_modifier = tunnel_chaos }
        
        # Teleport checks so the event is valid
        any_owned_province = {
            continent = continent_northrend
            num_of_units_in_province = {
                who = ROOT
                amount = 1
            }
        }
        
        FROM = {
            any_owned_province = {
                continent = continent_northrend
                NOT = {
                    num_of_units_in_province = {
                        who = ROOT
                        amount = 1
                    }
                }
            }
        }
        
		mil_power = 25
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - teleport_army"
            }
            
            set_country_flag = teleport_type_tunnel
        }
        
        add_mil_power = -25
        
        FROM = {
            save_event_target_as = hostile_country
        }
        country_event = { id = wwu_teleport_system.10 }
        
        hidden_effect = {
            add_country_modifier = {
                name = tunnel_chaos
                duration = 365
                hidden = yes
            }
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {  
        # Should reduce usage by the AI to a suitable level
        mil_power = 400
	}
}

#---------------------------------------
# Scout Territory
#---------------------------------------
scout_territory = {
	category = influence
	
	alert_index = 40
	alert_tooltip = scout_territory_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        # Only available whilst at war with target
        war_with = FROM
        FROM = {
            any_owned_province = {
                NOT = { has_discovered = ROOT }
            }
        }
	}
	is_allowed = {
		dip_power = 250
	}
	on_accept = {
        hidden_effect = {
            if = { 
                limit = { has_global_flag = enable_diplomacy_logging }
                log = "DEBUG - [Root.GetName], [From.GetName] - scout_territory"
            }
        }
        
        add_dip_power = -250
        
        # Discover all enemy lands
        FROM = {
            every_owned_province = {
                discover_country = ROOT
            }
            every_subject_country = {
                every_owned_province = {
                    discover_country = ROOT
                }
            }
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {  
        # Should reduce usage by the AI to a suitable level
        dip_power = 800
	}
}

#---------------------------------------
# Magic
#---------------------------------------
# Chi Magic: Touch of Death
apply_touch_of_death = {
	category = influence
	
	alert_index = 40
	alert_tooltip = apply_touch_of_death_tooltip
	
	require_acceptance = no # Whether the recipient gets an option to decline
	
	is_visible = {
        has_country_flag = touch_of_death
	}
	is_allowed = {
        always = yes
	}
	on_accept = {
        hidden_effect = {
            clr_country_flag = touch_of_death
        }
        FROM = {
            kill_ruler = yes
        }
	}
	on_decline = { 
	}
	
	ai_acceptance = { 
	}

	ai_will_do = {
		always = yes
	}
}