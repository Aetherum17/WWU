#----------------------------------------
# Magic GUI
#----------------------------------------
#--------------
# Court View
#--------------
# For rulers that can learn to be spellcasters
custom_button = {
    name = ruler_magic_study_button
    tooltip = SPELLBOOK_MAGICAL_STUDY_HOVER_TT
    
    potential = {
        ai = no
        NOT = { has_ruler_modifier = spellcaster_capabilities }
    }
    
    trigger = { 
        custom_trigger_tooltip = {
            tooltip = MAGIC_GUI_STUDY_NOT_OPEN_TT
            NOT = { has_country_flag = gui_flag__magic_study_gui_open }
        }
    }
    
    effect = { 
        hidden_effect = {
            set_country_flag = gui_flag__magic_study_gui_open
        }
    }
}

# For rulers that are spellcasters
custom_button = {
    name = ruler_magic_usage_button
    tooltip = SPELLBOOK_HOVER_TT
    
    potential = {
        ai = no
        has_ruler_modifier = spellcaster_capabilities
    }
    
    trigger = { 
        custom_trigger_tooltip = {
            tooltip = MAGIC_GUI_USAGE_NOT_OPEN_TT
            NOT = { has_country_flag = gui_flag__magic_usage_gui_open }
        }
    }
    
    effect = { 
        hidden_effect = {
            set_country_flag = gui_flag__magic_usage_gui_open
        }
    }
}

#--------------
# Magic GUI Shared
#--------------
# Background
custom_icon = {
   name = magic_usage_view_background
   potential = { 
        has_country_flag = gui_flag__magic_usage_gui_open
   }
}

# Background
custom_icon = {
   name = magic_study_view_background
   potential = { 
        has_country_flag = gui_flag__magic_study_gui_open
   }
}

# Back Button
custom_button = {
    name = magic_gui_back_button
    
    potential = {
        OR = {
            has_country_flag = gui_flag__magic_study_gui_open
            has_country_flag = gui_flag__magic_usage_gui_open
        }
    }
    
    trigger = { 
        
    }
    
    effect = { 
        hidden_effect = {
            clr_country_flag = gui_flag__magic_study_gui_open
            clr_country_flag = gui_flag__magic_usage_gui_open
        }
    }
}

#--------------
# Magic Study
#--------------
custom_text_box = {
   name = magic_gui_study_title
   potential = { 
        has_country_flag = gui_flag__magic_study_gui_open
   }
}

# Start Study
custom_button = {
    name = magic_gui_start_magic_study
   tooltip = MAGIC_STUDY_START_HOVER_TT
    
    potential = {
        has_country_flag = gui_flag__magic_study_gui_open
        NOT = { has_ruler_modifier = magical_training }
    }
    
    trigger = { 
        if = {
            limit = {
                OR = {
                    has_ruler_flag = mage_personality
                    has_ruler_flag = priest_personality
                    has_ruler_flag = warlock_personality
                    has_ruler_flag = druid_personality
                    has_reform = wwu_magic_free_magic
                }
            }
            
            adm_power = 20
            dip_power = 20
            mil_power = 20
        }
        else = {
            adm_power = 100
            dip_power = 100
            mil_power = 100
        }
    }
    
    effect = { 
        if = {
            limit = {
                OR = {
                    has_ruler_flag = mage_personality
                    has_ruler_flag = priest_personality
                    has_ruler_flag = warlock_personality
                    has_ruler_flag = druid_personality
                    has_reform = wwu_magic_free_magic
                }
            }
            
            add_adm_power = -20
            add_dip_power = -20
            add_mil_power = -20
        }
        else = {
            add_adm_power = -100
            add_dip_power = -100
            add_mil_power = -100
        }
        
        add_ruler_modifier = {
            name = magical_training
            duration = -1
        }
        
        hidden_effect = {
            set_variable = {
                which = magical_study_progress
                value = 0.0
            }
            set_country_flag = magical_study_progress_var_exists
        }
    }
}

# Cancel Study
custom_button = {
    name = magic_gui_cancel_magic_study
   tooltip = MAGIC_STUDY_CANCEL_HOVER_TT
    
    potential = {
        has_country_flag = gui_flag__magic_study_gui_open
        has_ruler_modifier = magical_training
    }
    
    trigger = { 
        
    }
    
    effect = { 
        remove_country_modifier = magical_training
        custom_tooltip = MAGIC_STUDY_RESUME_TT
    }
}

# Boost Study
custom_button = {
    name = magic_gui_boost_magic_study
   tooltip = MAGIC_STUDY_BOOST_HOVER_TT
    
    potential = {
        has_country_flag = gui_flag__magic_study_gui_open
        has_ruler_modifier = magical_training
    }
    
    trigger = {     
        NOT = {
            check_variable = {
                which = magical_study_progress
                value = 100.0
            }
        }
        
        if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 1 }
            }
            years_of_income = 2.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 2 }
            }
            years_of_income = 3.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 3 }
            }
            years_of_income = 4.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 4 }
            }
            years_of_income = 5.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 5 }
            }
            years_of_income = 6.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 6 }
            }
            years_of_income = 7.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 7 }
            }
            years_of_income = 8.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 8 }
            }
            years_of_income = 9.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 9 }
            }
            years_of_income = 10.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 10 }
            }
            years_of_income = 10.0
        }
        else = {
            years_of_income = 1.0
        }
    }
    
    effect = { 
        custom_tooltip = BOOST_MAGIC_STUDY_BY_5_TT
            
        
        if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 1 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 2 } }
            add_years_of_income = -2.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 2 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 3 } }
            add_years_of_income = -3.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 3 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 4 } }
            add_years_of_income = -4.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 4 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 5 } }
            add_years_of_income = -5.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 5 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 6 } }
            add_years_of_income = -6.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 6 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 7 } }
            add_years_of_income = -7.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 7 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 8 } }
            add_years_of_income = -8.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 8 }
            }
            
            hidden_effect = { set_variable = { which = study_difficulty value = 9 } }
            add_years_of_income = -9.0
        }
        else_if = {
            limit = {
                is_variable_equal = { which = study_difficulty value = 9 }
            }
            
            add_years_of_income = -10.0
        }
        else = {
            hidden_effect = { set_variable = { which = study_difficulty value = 1 } }
            add_years_of_income = -1.0
        }
            
        hidden_effect = {
            change_variable = { which = magical_study_progress value = 5 }
            set_country_flag = magical_study_progress_var_exists
            
            # Cap at 100
            if = {
                limit = {
                    check_variable = {
                        which = magical_study_progress
                        value = 100.0
                    }
                }
                
                set_variable = {
                    which = magical_study_progress
                    value = 100.0
                }
            } 
        }
    }
}

custom_text_box = {
   name = magic_gui_study_progress_text
   tooltip = STUDY_PROGRESS_HOVER_TT
   
   potential = { 
        has_country_flag = gui_flag__magic_study_gui_open
   }
}

#--------------
# Magic Usage
#--------------
custom_text_box = {
   name = magic_gui_usage_title
   potential = { 
        has_country_flag = gui_flag__magic_usage_gui_open
   }
}
