#-----------------------------------
# On Actions
#-----------------------------------
on_startup__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        setup_archaeology_view = yes
        setup_achievements_view = yes
        fill_clique_influence_variables = yes
    }
}

on_country_released__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        setup_archaeology_view = yes
        setup_achievements_view = yes
        fill_clique_influence_variables = yes
    }
}

on_country_creation__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        setup_archaeology_view = yes
        setup_achievements_view = yes
        fill_clique_influence_variables = yes
    }
}

on_monthly_pulse__custom_gui = {
    if = {
        limit = {
            ai = no
        }
        
        update_faction_gui_state = yes
        setup_clique_view = yes
        fill_clique_influence_variables = yes
        
        if = {
            limit = {
                NOT = { has_country_flag = gui_flag__display_archaeology_view_page_1 }
                NOT = { has_country_flag = gui_flag__display_archaeology_view_page_2 }
            }
            
            set_country_flag = gui_flag__display_archaeology_view_page_1
        }
        
        if = {
            limit = {
                NOT = { has_country_flag = gui_flag__display_achievements_view_page_1 }
                NOT = { has_country_flag = gui_flag__display_achievements_view_page_2 }
            }
            
            set_country_flag = gui_flag__display_achievements_view_page_1
        }
    }
}

# Faction GUI
update_faction_gui_state = {
    # Add Custom GUI faction if not present
    if = {
        limit = {
            NOT = { has_faction = faction_custom_gui }
        }
        
        add_faction = faction_custom_gui
    }
}

#-----------------------------------
# Windows
#-----------------------------------
# Ruler Information Panel
open_ruler_information_panel = {
    hidden_effect = { set_country_flag = gui_flag__court_view_ruler_information_panel_open }
}

close_ruler_information_panel = {
    hidden_effect = { clr_country_flag = gui_flag__court_view_ruler_information_panel_open }
}

# Magical Study
open_magical_study_gui = {
    hidden_effect = { set_country_flag = gui_flag__magic_study_gui_open }
}

close_magical_study_gui = {
    hidden_effect = { clr_country_flag = gui_flag__magic_study_gui_open }
}

# Spellbook
open_spellbook_gui = {
    hidden_effect = { set_country_flag = gui_flag__magic_usage_gui_open }
}

close_spellbook_gui = {
    hidden_effect = { clr_country_flag = gui_flag__magic_usage_gui_open }
}

# Magic School Selection Panel
open_magic_school_selection_panel = {
    hidden_effect = { set_country_flag = gui_flag__magic_school_selection_open }
}

close_magic_school_selection_panel = {
    hidden_effect = { clr_country_flag = gui_flag__magic_school_selection_open }
}

# Class Study
open_class_study_gui = {
    hidden_effect = { set_country_flag = gui_flag__class_study_gui_open }
}

close_class_study_gui = {
    hidden_effect = { clr_country_flag = gui_flag__class_study_gui_open }
}

# Class Abilities
open_class_abilities_gui = {
    hidden_effect = { set_country_flag = gui_flag__class_abilities_gui_open }
}

close_class_abilities_gui = {
    hidden_effect = { clr_country_flag = gui_flag__class_abilities_gui_open }
}

# Class Selection Panel
open_class_selection_panel = {
    hidden_effect = { set_country_flag = gui_flag__class_selection_gui_open }
}

close_class_selection_panel = {
    hidden_effect = { clr_country_flag = gui_flag__class_selection_gui_open }
}

# Faction GUI
close_all_faction_windows = {
    close_stratagem_gui = yes
    close_archaeology_gui = yes
    close_clique_gui = yes
    close_national_identity_gui = yes
    close_building_management_gui = yes
    close_achievements_gui = yes
}


# Stratagems
open_stratagem_gui = {
    hidden_effect = { set_country_flag = gui_flag__stratagem_gui_open }
}

close_stratagem_gui = {
    hidden_effect = { clr_country_flag = gui_flag__stratagem_gui_open }
}

# Archaeology
open_archaeology_gui = {
    hidden_effect = { set_country_flag = gui_flag__archaeology_gui_open }
}

close_archaeology_gui = {
    hidden_effect = { clr_country_flag = gui_flag__archaeology_gui_open }
}

# Clique
open_clique_gui = {
    hidden_effect = { set_country_flag = gui_flag__clique_gui_open }
}

close_clique_gui = {
    hidden_effect = { clr_country_flag = gui_flag__clique_gui_open }
}

# National Identity
open_national_identity_gui = {
    hidden_effect = { set_country_flag = gui_flag__national_identity_gui_open }
}

close_national_identity_gui = {
    hidden_effect = { clr_country_flag = gui_flag__national_identity_gui_open }
}

# Building Management
open_building_management_gui = {
    hidden_effect = { set_country_flag = gui_flag__building_management_gui_open }
}

close_building_management_gui = {
    hidden_effect = { clr_country_flag = gui_flag__building_management_gui_open }
}

# Achievements
open_achievements_gui = {
    hidden_effect = { set_country_flag = gui_flag__achievements_gui_open }
}

close_achievements_gui = {
    hidden_effect = { clr_country_flag = gui_flag__achievements_gui_open }
}

#-----------------------------------
# Clique Views
#-----------------------------------
setup_clique_view = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_clique__merchant_republic
        clr_country_flag = gui_flag__display_clique__pirate_republic
        clr_country_flag = gui_flag__display_clique__scourge
        clr_country_flag = gui_flag__display_clique__quelthalas
        clr_country_flag = gui_flag__display_clique__naga
        clr_country_flag = gui_flag__display_clique__gorian_empire
        clr_country_flag = gui_flag__display_clique__criminal_organisation
        clr_country_flag = gui_flag__display_clique__kul_tiras
        
        if = {
            limit = {
                has_merchant_republic_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__merchant_republic
        }
        if = {
            limit = {
                has_pirate_republic_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__pirate_republic
        }
        if = {
            limit = {
                has_scourge_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__scourge
        }
        if = {
            limit = {
                has_quelthalas_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__quelthalas
        }
        if = {
            limit = {
                has_naga_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__naga
        }
        if = {
            limit = {
                has_gorian_empire_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__gorian_empire
        }
        if = {
            limit = {
                has_criminal_organisation_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__criminal_organisation
        }
        if = {
            limit = {
                has_kul_tiras_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__kul_tiras
        }
    }
}

#-----------------------------
# Archaeology GUI
#-----------------------------
setup_archaeology_view = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_archaeology_view_page_1
        clr_country_flag = gui_flag__display_archaeology_view_page_2
        
        set_country_flag = gui_flag__display_archaeology_view_page_1
    }
}

set_artifact_view_page_1 = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_archaeology_view_page_1
        clr_country_flag = gui_flag__display_archaeology_view_page_2
        
        set_country_flag = gui_flag__display_archaeology_view_page_1
    }
}

set_artifact_view_page_2 = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_archaeology_view_page_1
        clr_country_flag = gui_flag__display_archaeology_view_page_2
        
        set_country_flag = gui_flag__display_archaeology_view_page_2
    }
}

#-----------------------------
# Achievements GUI
#-----------------------------
setup_achievements_view = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_achievements_view_page_1
        clr_country_flag = gui_flag__display_achievements_view_page_2
        
        set_country_flag = gui_flag__display_achievements_view_page_1
    }
}

set_achievements_view_page_1 = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_achievements_view_page_1
        clr_country_flag = gui_flag__display_achievements_view_page_2
        
        set_country_flag = gui_flag__display_achievements_view_page_1
    }
}
set_achievements_view_page_2 = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_achievements_view_page_1
        clr_country_flag = gui_flag__display_achievements_view_page_2
        
        set_country_flag = gui_flag__display_achievements_view_page_2
    }
}

# Achievements
apply_achievement_reward__world_conqueror = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__world_conqueror }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__world_conqueror
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__one_faith = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__one_faith }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__one_faith
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__gold_gold_gold = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__gold_gold_gold }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__gold_gold_gold
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__uplifted = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__uplifted }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__uplifted
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__disturbing_the_peace = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__disturbing_the_peace }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__disturbing_the_peace
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__world_drinking_tour = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__world_drinking_tour }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__world_drinking_tour
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__one_with_the_trees = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__one_with_the_trees }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__one_with_the_trees
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__extradimensional_conquest = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__extradimensional_conquest }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__extradimensional_conquest
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__argent_champion = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__argent_champion }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__argent_champion
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__dis_here_troll_land = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__dis_here_troll_land }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__dis_here_troll_land
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__goblinlake = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__goblinlake }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__goblinlake
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__stormwind_united = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__stormwind_united }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__stormwind_united
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__lords_of_stone = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__lords_of_stone }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__lords_of_stone
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__the_four_bananas = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__the_four_bananas }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__the_four_bananas
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__all_your_bananas_belong_to_us = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__all_your_bananas_belong_to_us }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__all_your_bananas_belong_to_us
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__true_heir_of_arathor = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__true_heir_of_arathor }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__true_heir_of_arathor
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__the_candle_kingdom = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__the_candle_kingdom }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__the_candle_kingdom
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__port_forward = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__port_forward }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__port_forward
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__frozen_assets = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__frozen_assets }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__frozen_assets
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__invasion_of_the_furbolgs = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__invasion_of_the_furbolgs }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__invasion_of_the_furbolgs
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__elunes_grace = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__elunes_grace }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__elunes_grace
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__everybody_loves_fel = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__everybody_loves_fel }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__everybody_loves_fel
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__the_light_will_forge_you_a_new_one = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__the_light_will_forge_you_a_new_one }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__the_light_will_forge_you_a_new_one
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__orgrims_ambition = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__orgrims_ambition }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__orgrims_ambition
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__unification_of_draenor = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__unification_of_draenor }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__unification_of_draenor
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__thunder_lightning_very_very_frightning = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__thunder_lightning_very_very_frightning }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__thunder_lightning_very_very_frightning
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__snow_problem = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__snow_problem }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__snow_problem
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}

apply_achievement_reward__blackrock_n_roll = {
    if = {
        limit = {
            NOT = { has_country_flag = completed_achievement__blackrock_n_roll }
        }

        hidden_effect = {
            set_country_flag = completed_achievement__blackrock_n_roll
        }
        
        add_prestige = 10
    }
    else = {
        custom_tooltip = ACHIEVEMENT_COMPLETED_ALREADY
    }
}