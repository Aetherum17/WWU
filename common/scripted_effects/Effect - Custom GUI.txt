#-----------------------------------
# On Actions
#-----------------------------------
on_startup__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        fill_clique_influence_variables = yes
    }
}

on_country_released__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        fill_clique_influence_variables = yes
    }
}

on_country_creation__custom_gui = {
    set_country_flag = gui_flag__national_identity_gui_open
    
    if = {
        limit = {
            ai = no
        }
        update_faction_gui_state = yes
        setup_clique_view = yes
        fill_clique_influence_variables = yes
    }
}

on_monthly_pulse__custom_gui = {
    if = {
        limit = {
            ai = no
        }
        
        update_faction_gui_state = yes
        setup_clique_view = yes
        fill_clique_influence_variables = yes
    }
}

# Faction GUI
update_faction_gui_state = {
    # Add Custom GUI faction if not present
    if = {
        limit = {
            NOT = { has_faction = faction_custom_gui }
        }
        
        add_faction = faction_custom_gui
    }
}

#-----------------------------------
# Windows
#-----------------------------------
# Ruler Information Panel
open_ruler_information_panel = {
    hidden_effect = { set_country_flag = gui_flag__court_view_ruler_information_panel_open }
}

close_ruler_information_panel = {
    hidden_effect = { clr_country_flag = gui_flag__court_view_ruler_information_panel_open }
}

# Magical Study
open_magical_study_gui = {
    hidden_effect = { set_country_flag = gui_flag__magic_study_gui_open }
}

close_magical_study_gui = {
    hidden_effect = { clr_country_flag = gui_flag__magic_study_gui_open }
}

# Spellbook
open_spellbook_gui = {
    hidden_effect = { set_country_flag = gui_flag__magic_usage_gui_open }
}

close_spellbook_gui = {
    hidden_effect = { clr_country_flag = gui_flag__magic_usage_gui_open }
}

# Magic School Selection Panel
open_magic_school_selection_panel = {
    hidden_effect = { set_country_flag = gui_flag__magic_school_selection_open }
}

close_magic_school_selection_panel = {
    hidden_effect = { clr_country_flag = gui_flag__magic_school_selection_open }
}

# Class Study
open_class_study_gui = {
    hidden_effect = { set_country_flag = gui_flag__class_study_gui_open }
}

close_class_study_gui = {
    hidden_effect = { clr_country_flag = gui_flag__class_study_gui_open }
}

# Class Abilities
open_class_abilities_gui = {
    hidden_effect = { set_country_flag = gui_flag__class_abilities_gui_open }
}

close_class_abilities_gui = {
    hidden_effect = { clr_country_flag = gui_flag__class_abilities_gui_open }
}

# Class Selection Panel
open_class_selection_panel = {
    hidden_effect = { set_country_flag = gui_flag__class_selection_gui_open }
}

close_class_selection_panel = {
    hidden_effect = { clr_country_flag = gui_flag__class_selection_gui_open }
}

# Faction GUI
close_all_faction_windows = {
    close_stratagem_gui = yes
    close_archaeology_gui = yes
    close_clique_gui = yes
    close_national_identity_gui = yes
    close_building_management_gui = yes
}


# Stratagems
open_stratagem_gui = {
    hidden_effect = { set_country_flag = gui_flag__stratagem_gui_open }
}

close_stratagem_gui = {
    hidden_effect = { clr_country_flag = gui_flag__stratagem_gui_open }
}

# Archaeology
open_archaeology_gui = {
    hidden_effect = { set_country_flag = gui_flag__archaeology_gui_open }
}

close_archaeology_gui = {
    hidden_effect = { clr_country_flag = gui_flag__archaeology_gui_open }
}

# Clique
open_clique_gui = {
    hidden_effect = { set_country_flag = gui_flag__clique_gui_open }
}

close_clique_gui = {
    hidden_effect = { clr_country_flag = gui_flag__clique_gui_open }
}

# National Identity
open_national_identity_gui = {
    hidden_effect = { set_country_flag = gui_flag__national_identity_gui_open }
}

close_national_identity_gui = {
    hidden_effect = { clr_country_flag = gui_flag__national_identity_gui_open }
}

# Building Management
open_building_management_gui = {
    hidden_effect = { set_country_flag = gui_flag__building_management_gui_open }
}

close_building_management_gui = {
    hidden_effect = { clr_country_flag = gui_flag__building_management_gui_open }
}

#-----------------------------------
# Clique Views
#-----------------------------------
setup_clique_view = {
    hidden_effect = {
        clr_country_flag = gui_flag__display_clique__merchant_republic
        clr_country_flag = gui_flag__display_clique__pirate_republic
        clr_country_flag = gui_flag__display_clique__scourge
        clr_country_flag = gui_flag__display_clique__quelthalas
        clr_country_flag = gui_flag__display_clique__naga
        clr_country_flag = gui_flag__display_clique__gorian_empire
        clr_country_flag = gui_flag__display_clique__criminal_organisation
        clr_country_flag = gui_flag__display_clique__kul_tiras
        
        if = {
            limit = {
                has_merchant_republic_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__merchant_republic
        }
        if = {
            limit = {
                has_pirate_republic_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__pirate_republic
        }
        if = {
            limit = {
                has_scourge_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__scourge
        }
        if = {
            limit = {
                has_quelthalas_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__quelthalas
        }
        if = {
            limit = {
                has_naga_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__naga
        }
        if = {
            limit = {
                has_gorian_empire_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__gorian_empire
        }
        if = {
            limit = {
                has_criminal_organisation_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__criminal_organisation
        }
        if = {
            limit = {
                has_kul_tiras_clique = yes
            }
            
            set_country_flag = gui_flag__display_clique__kul_tiras
        }
    }
}

#-----------------------------------
# Clique Actions
#-----------------------------------
take_clique_influence_cost = {
    add_adm_power = -50
    add_dip_power = -50
    add_mil_power = -50
}

# Merchant Republic
boost_clique_influence__aristocrats = {
    add_country_modifier = {
        name = clique_boost_aristocrats
        duration = 3650
    }
}
boost_clique_influence__traders = {
    add_country_modifier = {
        name = clique_boost_traders
        duration = 3650
    }
}
boost_clique_influence__guilds = {
    add_country_modifier = {
        name = clique_boost_guilds
        duration = 3650
    }
}

# Pirate Republic
boost_clique_influence__buccaneers = {
    add_country_modifier = {
        name = clique_boost_buccaneers
        duration = 3650
    }
}
boost_clique_influence__smugglers = {
    add_country_modifier = {
        name = clique_boost_smugglers
        duration = 3650
    }
}
boost_clique_influence__captains = {
    add_country_modifier = {
        name = clique_boost_captains
        duration = 3650
    }
}

# Scourge
boost_clique_influence__death_knights = {
    add_country_modifier = {
        name = clique_boost_death_knights
        duration = 3650
    }
}
boost_clique_influence__lichs = {
    add_country_modifier = {
        name = clique_boost_lichs
        duration = 3650
    }
}
boost_clique_influence__darkfallen = {
    add_country_modifier = {
        name = clique_boost_darkfallen
        duration = 3650
    }
}

# Quel'Thalas
boost_clique_influence__magisters = {
    add_country_modifier = {
        name = clique_boost_magisters
        duration = 3650
    }
}
boost_clique_influence__farstriders = {
    add_country_modifier = {
        name = clique_boost_farstriders
        duration = 3650
    }
}
boost_clique_influence__blood_knights = {
    add_country_modifier = {
        name = clique_boost_blood_knights
        duration = 3650
    }
}

# Naga
boost_clique_influence__warlords = {
    add_country_modifier = {
        name = clique_boost_warlords
        duration = 3650
    }
}
boost_clique_influence__mistresses = {
    add_country_modifier = {
        name = clique_boost_mistresses
        duration = 3650
    }
}
boost_clique_influence__harbingers = {
    add_country_modifier = {
        name = clique_boost_harbingers
        duration = 3650
    }
}

# Gorian Empire
boost_clique_influence__sorcerers = {
    add_country_modifier = {
        name = clique_boost_sorcerers
        duration = 3650
    }
}
boost_clique_influence__stone_magi = {
    add_country_modifier = {
        name = clique_boost_stone_magi
        duration = 3650
    }
}
boost_clique_influence__magic_breakers = {
    add_country_modifier = {
        name = clique_boost_magic_breakers
        duration = 3650
    }
}

# Criminal Organisation
boost_clique_influence__bandits = {
    add_country_modifier = {
        name = clique_boost_bandits
        duration = 3650
    }
}
boost_clique_influence__thieves = {
    add_country_modifier = {
        name = clique_boost_thieves
        duration = 3650
    }
}
boost_clique_influence__cartels = {
    add_country_modifier = {
        name = clique_boost_cartels
        duration = 3650
    }
}

# Kul Tiras
boost_clique_influence__proudmoore = {
    add_country_modifier = {
        name = clique_boost_proudmoore
        duration = 3650
    }
}
boost_clique_influence__stormsong = {
    add_country_modifier = {
        name = clique_boost_stormsong
        duration = 3650
    }
}
boost_clique_influence__ashvane = {
    add_country_modifier = {
        name = clique_boost_ashvane
        duration = 3650
    }
}
boost_clique_influence__waycrest = {
    add_country_modifier = {
        name = clique_boost_waycrest
        duration = 3650
    }
}