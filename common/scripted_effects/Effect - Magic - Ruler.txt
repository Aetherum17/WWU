#-----------------------------------
# On Actions
#-----------------------------------
# ROOT = Country
on_new_monarch__magic = {
    reset_spellcaster_skills = yes
    
    # Jaina
    if = {
        limit = {
            has_ruler = "Jaina"
            dynasty = "Proudmoore"
            has_global_flag = jaina_in_dalaran
        }
        
        add_ruler_spellcasting = yes
        set_variable = {
            which = ruler_magic_aptitude
            value = 2
        }
        set_variable = {
            which = ruler_magic_finesse
            value = 2
        }
        set_variable = {
            which = ruler_magic_concentration
            value = 2
        }
    }
    
    # Add the Spellcaster mechanic automatically for these monarchs
    if = {
        limit = {
            OR = {
                has_government_attribute = enables_automatic_spellcasting_ruler
                has_government_attribute = enables_automatic_spellcasting_ruler_strong
            }
        }
        
        add_ruler_spellcasting = yes
        
        country_event = { id = wwu_magic.80 }
    
        random_list = {
            33 = {
                set_variable = {
                    which = ruler_magic_aptitude
                    value = 1
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_aptitude
                    value = 2
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_aptitude
                    value = 3
                }
            }
        }
        random_list = {
            33 = {
                set_variable = {
                    which = ruler_magic_finesse
                    value = 1
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_finesse
                    value = 2
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_finesse
                    value = 3
                }
            }
        }
        random_list = {
            33 = {
                set_variable = {
                    which = ruler_magic_concentration
                    value = 1
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_concentration
                    value = 2
                }
            }
            33 = {
                set_variable = {
                    which = ruler_magic_concentration
                    value = 3
                }
            }
        }
        
        # Adjustment: for countries that would have more powerful spellcasters by default
        if = {
            limit = {
                has_government_attribute = enables_automatic_spellcasting_ruler_strong
            }
            change_variable = {
                which = ruler_magic_aptitude
                value = 2
            }
            change_variable = {
                which = ruler_magic_finesse
                value = 2
            }
            change_variable = {
                which = ruler_magic_concentration
                value = 2
            }
        }
    }
}

# ROOT = Country
on_monarch_death__magic = {
    # Reset Spellcaster training
    set_variable = {
        which = ruler_magic_training
        value = 0
    }
}

existing_school_cost = {
    # Cost if school has already been set
    if = {
        limit = {
            NOT = {
                is_variable_equal = { 
                    which = magic_school
                    value = 0
                }
            }
        }
        
        add_years_of_income = -3
    }
}