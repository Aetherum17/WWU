#------------------------
# Global
#------------------------
# General global settings
global_setup_init = {
    # Set first player country as executor tag
    save_global_event_target_as = executor
    
    # World State
    #hre_inheritable = yes
    #set_papacy_active = no
    
    # Initializes variables which are used in on_actions
    init_variables = yes
    
    # Religious and Cultural Unity for ALL NATIONS on start and Core creation.
    # This will override history files in default setting. See script file to see how to avoid overriding.
    # init_full_unity = yes

    # Invention Timer
    set_global_flag = game_duration_timer
    
    # Custom Pulses
    291 = {
        add_province_triggered_modifier = generic_pulse_daily
        add_province_triggered_modifier = generic_pulse_two_monthly
        add_province_triggered_modifier = generic_pulse_yearly
    }
}

# Story flags
global_setup_story_progress = {
    # Rise of the Horde
    if = { 
        limit = {
            is_year = 546
        }
        set_global_flag = rise_of_the_horde
    }
    
    # The First War
    if = {
        limit = {
            is_year = 592
        }
        set_global_flag = the_first_war
        set_global_flag = dark_portal_opened_flag
        set_global_flag = dark_portal_built
        
        set_global_flag = alliance_exists
        set_global_flag = setup_the_alliance
        
        set_global_flag = old_horde_exists
        set_global_flag = setup_the_old_horde
        
        # Disable Old Horde country setup events
        set_global_flag = old_horde_country_setup
        
        # Add Draenor portal (ignore if past year 600)
        if = {
            limit = {
                NOT = { is_year = 600 }
            }
            
            3792 = {
                add_great_project = {
                    type = dark_portal_draenor
                    instant = yes
                }
            }
        }
    }

    # The Second War
    if = { 
        limit = {
            is_year = 598
        }
        
        set_global_flag = the_second_war
    }
    
    # Beyond The Dark Portal
    if = { 
        limit = {
            is_year = 600
        }
        
        # Disable Outland country setup events
        set_global_flag = setup_outland
        set_global_flag = outland_country_setup
        
        set_global_flag = beyond_the_dark_portal
        clr_global_flag = dark_portal_opened_flag
        set_global_flag = dark_portal_closed_firsttime
        set_global_flag = sonsoflothar
        set_global_flag = khadgar
        
        # Add Outland portal
        1586 = {
            add_great_project = {
                type = dark_portal_outland
                instant = yes
            }
        }
    }
    
    # Rise of the Lich King
    if = { 
        limit = {
            is_year = 605
        }
        set_global_flag = setup_outland
        set_global_flag = fel_horde_spawned 
    }

    # The Third War
    if = { 
        limit = {
            is_year = 617
        }
        set_global_flag = the_third_war 
        set_global_flag = scourge_of_lordaeron_flag
        set_global_flag = scourge_invasion # Used for the secondary Scourge tree
        
        set_global_flag = setup_outland
    }

    # The Frozen Throne
    if = { 
        limit = {
            is_year = 618
        }
        set_global_flag = the_third_war 
        set_global_flag = scourge_of_lordaeron_flag
        set_global_flag = the_frozen_throne
        set_global_flag = archimonde_dead
        set_global_flag = nerzhul_arrived
    }

    # The Rise of the Qiraji
    if = { 
        limit = {
            is_year = 622
        }
        set_global_flag = rise_of_the_qiraji
        set_global_flag = illidan_frozen_throne
        
        set_global_flag = horde_exists
        set_global_flag = setup_the_horde
        
        clr_global_flag = old_horde_exists
        clr_global_flag = setup_the_old_horde
        
        set_global_flag = northgate_rebellion_happened
        
        set_global_flag = setup_bloodsail
        
        # Story events that should not occur after this date
        set_global_flag = kaelthas_uneasy_alliance
        set_global_flag = kaelthas_garithos_betrayal
        set_global_flag = lady_vashj_exodus_to_outland
        set_global_flag = kaelthas_exodus_to_outland
        set_global_flag = illidan_kiljaeden_bargain
        set_global_flag = illidan_naga
        set_global_flag = illidan_eye_of_sargeras_retrieved
        set_global_flag = scourge_response_eye_of_sargeras
        set_global_flag = illidan_used_eye_of_sargeras
        set_global_flag = scourge_frozen_throne_safe
        set_global_flag = scourge_frozen_throne_destroyed
        set_global_flag = eye_of_sargeras_disrupted
        set_global_flag = illidari_spawned
        set_global_flag = ashtongue_deathsworn_spawned
    }

    # The Burning Crusade
    if = { 
        limit = {
            is_year = 625
        }
        set_global_flag = the_burning_crusade
    }

    # Wrath of the Lich King
    if = { 
        limit = {
            is_year = 626
        }
        set_global_flag = wrath_of_the_lich_king
    }

    # Cataclysm
    if = { 
        limit = {
            is_year = 631
        }
        set_global_flag = cataclysm
    }

    # Mists of Pandaria
    if = { 
        limit = {
            is_year = 632
        }
        set_global_flag = mists_of_pandaria
    }
    if = { 
        limit = {
            is_year = 700
        }
        set_global_flag = doomed_world
    }
}

wwu_add_canals = {
	if = {
		limit = {
			OR = {
				617 = { has_great_project = { type = deep_sea_current_1 tier = 1 } }
				617 = { has_great_project = { type = deep_sea_current_1 tier = 2 } }
				617 = { has_great_project = { type = deep_sea_current_1 tier = 3 } }
			}
		}
		617 = { add_canal = deep_sea_current_1 }
	}
	if = {
		limit = {
			OR = {
				4923 = { has_great_project = { type = deep_sea_current_2 tier = 1 } }
				4923 = { has_great_project = { type = deep_sea_current_2 tier = 2 } }
				4923 = { has_great_project = { type = deep_sea_current_2 tier = 3 } }
			}
		}
		4923 = { add_canal = deep_sea_current_2 }
	}
	if = {
		limit = {
			OR = {
				4923 = { has_great_project = { type = deep_sea_current_3 tier = 1 } }
				4923 = { has_great_project = { type = deep_sea_current_3 tier = 2 } }
				4923 = { has_great_project = { type = deep_sea_current_3 tier = 3 } }
			}
		}
		4933 = { add_canal = deep_sea_current_3 }
	}
	if = {
		limit = {
			OR = {
				4925 = { has_great_project = { type = deep_sea_current_4 tier = 1 } }
				4925 = { has_great_project = { type = deep_sea_current_4 tier = 2 } }
				4925 = { has_great_project = { type = deep_sea_current_4 tier = 3 } }
			}
		}
		4925 = { add_canal = deep_sea_current_4 }
	}
	if = {
		limit = {
			OR = {
				3174 = { has_great_project = { type = deep_sea_current_5 tier = 1 } }
				3174 = { has_great_project = { type = deep_sea_current_5 tier = 2 } }
				3174 = { has_great_project = { type = deep_sea_current_5 tier = 3 } }
			}
		}
		3174 = { add_canal = deep_sea_current_5 }
	}
	if = {
		limit = {
			OR = {
				577 = { has_great_project = { type = deep_sea_current_6 tier = 1 } }
				577 = { has_great_project = { type = deep_sea_current_6 tier = 2 } }
				577 = { has_great_project = { type = deep_sea_current_6 tier = 3 } }
			}
		}
		577 = { add_canal = deep_sea_current_6 }
	}
	if = {
		limit = {
			OR = {
				4893 = { has_great_project = { type = deep_sea_current_7 tier = 1 } }
				4893 = { has_great_project = { type = deep_sea_current_7 tier = 2 } }
				4893 = { has_great_project = { type = deep_sea_current_7 tier = 3 } }
			}
		}
		4893 = { add_canal = deep_sea_current_7 }
	}
	if = {
		limit = {
			OR = {
				4889 = { has_great_project = { type = deep_sea_current_8 tier = 1 } }
				4889 = { has_great_project = { type = deep_sea_current_8 tier = 2 } }
				4889 = { has_great_project = { type = deep_sea_current_8 tier = 3 } }
			}
		}
		4889 = { add_canal = deep_sea_current_8 }
	}
	if = {
		limit = {
			OR = {
				573 = { has_great_project = { type = deep_sea_current_9 tier = 1 } }
				573 = { has_great_project = { type = deep_sea_current_9 tier = 2 } }
				573 = { has_great_project = { type = deep_sea_current_9 tier = 3 } }
			}
		}
		573 = { add_canal = deep_sea_current_9 }
	}
	if = {
		limit = {
			OR = {
				4908 = { has_great_project = { type = deep_sea_current_10 tier = 1 } }
				4908 = { has_great_project = { type = deep_sea_current_10 tier = 2 } }
				4908 = { has_great_project = { type = deep_sea_current_10 tier = 3 } }
			}
		}
		4908 = { add_canal = deep_sea_current_10 }
	}
	if = {
		limit = {
			OR = {
				4901 = { has_great_project = { type = deep_sea_current_11 tier = 1 } }
				4901 = { has_great_project = { type = deep_sea_current_11 tier = 2 } }
				4901 = { has_great_project = { type = deep_sea_current_11 tier = 3 } }
			}
		}
		4901 = { add_canal = deep_sea_current_11 }
	}
	if = {
		limit = {
			OR = {
				4912 = { has_great_project = { type = deep_sea_current_12 tier = 1 } }
				4912 = { has_great_project = { type = deep_sea_current_12 tier = 2 } }
				4912 = { has_great_project = { type = deep_sea_current_12 tier = 3 } }
			}
		}
		4912 = { add_canal = deep_sea_current_12 }
	}
	if = {
		limit = {
			OR = {
				4926 = { has_great_project = { type = deep_sea_current_13 tier = 1 } }
				4926 = { has_great_project = { type = deep_sea_current_13 tier = 2 } }
				4926 = { has_great_project = { type = deep_sea_current_13 tier = 3 } }
			}
		}
		4926 = { add_canal = deep_sea_current_13 }
	}
	if = {
		limit = {
			OR = {
				2505 = { has_great_project = { type = deeprun_tram tier = 1 } }
				2505 = { has_great_project = { type = deeprun_tram tier = 2 } }
				2505 = { has_great_project = { type = deeprun_tram tier = 3 } }
			}
		}
		2505 = { add_canal = deeprun_tram }
	}
	if = {
		limit = {
			OR = {
				2535 = { has_great_project = { type = deepholm_rift_feralas tier = 1 } }
				2535 = { has_great_project = { type = deepholm_rift_feralas tier = 2 } }
				2535 = { has_great_project = { type = deepholm_rift_feralas tier = 3 } }
			}
		}
		2535 = { add_canal = deepholm_rift_feralas }
	}
	if = {
		limit = {
			OR = {
				2539 = { has_great_project = { type = deepholm_rift_arathi tier = 1 } }
				2539 = { has_great_project = { type = deepholm_rift_arathi tier = 2 } }
				2539 = { has_great_project = { type = deepholm_rift_arathi tier = 3 } }
			}
		}
		2539 = { add_canal = deepholm_rift_arathi }
	}
	if = {
		limit = {
			OR = {
				2532 = { has_great_project = { type = deepholm_rift_howling_fjord tier = 1 } }
				2532 = { has_great_project = { type = deepholm_rift_howling_fjord tier = 2 } }
				2532 = { has_great_project = { type = deepholm_rift_howling_fjord tier = 3 } }
			}
		}
		2532 = { add_canal = deepholm_rift_howling_fjord }
	}
	if = {
		limit = {
			OR = {
				3160 = { has_great_project = { type = deepholm_rift_kunlai tier = 1 } }
				3160 = { has_great_project = { type = deepholm_rift_kunlai tier = 2 } }
				3160 = { has_great_project = { type = deepholm_rift_kunlai tier = 3 } }
			}
		}
		3160 = { add_canal = deepholm_rift_kunlai }
	}
	if = {
		limit = {
			OR = {
				2548 = { has_great_project = { type = abyssal_maw_rift_vashjir tier = 1 } }
				2548 = { has_great_project = { type = abyssal_maw_rift_vashjir tier = 2 } }
				2548 = { has_great_project = { type = abyssal_maw_rift_vashjir tier = 3 } }
			}
		}
		2548 = { add_canal = abyssal_maw_rift_vashjir }
	}
	if = {
		limit = {
			OR = {
				2557 = { has_great_project = { type = abyssal_maw_rift_stonetalon tier = 1 } }
				2557 = { has_great_project = { type = abyssal_maw_rift_stonetalon tier = 2 } }
				2557 = { has_great_project = { type = abyssal_maw_rift_stonetalon tier = 3 } }
			}
		}
		2557 = { add_canal = abyssal_maw_rift_stonetalon }
	}
	if = {
		limit = {
			OR = {
				2564 = { has_great_project = { type = abyssal_maw_rift_sholazar tier = 1 } }
				2564 = { has_great_project = { type = abyssal_maw_rift_sholazar tier = 2 } }
				2564 = { has_great_project = { type = abyssal_maw_rift_sholazar tier = 3 } }
			}
		}
		2564 = { add_canal = abyssal_maw_rift_sholazar }
	}
	if = {
		limit = {
			OR = {
				2552 = { has_great_project = { type = abyssal_maw_rift_krasarang_wilds tier = 1 } }
				2552 = { has_great_project = { type = abyssal_maw_rift_krasarang_wilds tier = 2 } }
				2552 = { has_great_project = { type = abyssal_maw_rift_krasarang_wilds tier = 3 } }
			}
		}
		2552 = { add_canal = abyssal_maw_rift_krasarang_wilds }
	}
	if = {
		limit = {
			OR = {
				2576 = { has_great_project = { type = firelands_rift_blackrock tier = 1 } }
				2576 = { has_great_project = { type = firelands_rift_blackrock tier = 2 } }
				2576 = { has_great_project = { type = firelands_rift_blackrock tier = 3 } }
			}
		}
		2576 = { add_canal = firelands_rift_blackrock }
	}
	if = {
		limit = {
			OR = {
				2593 = { has_great_project = { type = firelands_rift_hyjal tier = 1 } }
				2593 = { has_great_project = { type = firelands_rift_hyjal tier = 2 } }
				2593 = { has_great_project = { type = firelands_rift_hyjal tier = 3 } }
			}
		}
		2593 = { add_canal = firelands_rift_hyjal }
	}
	if = {
		limit = {
			OR = {
				2585 = { has_great_project = { type = firelands_rift_boreal_tundra tier = 1 } }
				2585 = { has_great_project = { type = firelands_rift_boreal_tundra tier = 2 } }
				2585 = { has_great_project = { type = firelands_rift_boreal_tundra tier = 3 } }
			}
		}
		2585 = { add_canal = firelands_rift_boreal_tundra }
	}
	if = {
		limit = {
			OR = {
				2581 = { has_great_project = { type = firelands_rift_townlong_steppes tier = 1 } }
				2581 = { has_great_project = { type = firelands_rift_townlong_steppes tier = 2 } }
				2581 = { has_great_project = { type = firelands_rift_townlong_steppes tier = 3 } }
			}
		}
		2581 = { add_canal = firelands_rift_townlong_steppes }
	}
	if = {
		limit = {
			OR = {
				2523 = { has_great_project = { type = skywall_rift_uldum tier = 1 } }
				2523 = { has_great_project = { type = skywall_rift_uldum tier = 2 } }
				2523 = { has_great_project = { type = skywall_rift_uldum tier = 3 } }
			}
		}
		2523 = { add_canal = skywall_rift_uldum }
	}
	if = {
		limit = {
			OR = {
				2527 = { has_great_project = { type = skywall_rift_westfall tier = 1 } }
				2527 = { has_great_project = { type = skywall_rift_westfall tier = 2 } }
				2527 = { has_great_project = { type = skywall_rift_westfall tier = 3 } }
			}
		}
		2527 = { add_canal = skywall_rift_westfall }
	}
	if = {
		limit = {
			OR = {
				2530 = { has_great_project = { type = skywall_rift_dragonblight tier = 1 } }
				2530 = { has_great_project = { type = skywall_rift_dragonblight tier = 2 } }
				2530 = { has_great_project = { type = skywall_rift_dragonblight tier = 3 } }
			}
		}
		2530 = { add_canal = skywall_rift_dragonblight }
	}
	if = {
		limit = {
			OR = {
				2525 = { has_great_project = { type = skywall_rift_jade_forest tier = 1 } }
				2525 = { has_great_project = { type = skywall_rift_jade_forest tier = 2 } }
				2525 = { has_great_project = { type = skywall_rift_jade_forest tier = 3 } }
			}
		}
		2525 = { add_canal = skywall_rift_jade_forest }
	}
	if = {
		limit = {
			OR = {
				2764 = { has_great_project = { type = argus_rift_icecrown tier = 1 } }
				2764 = { has_great_project = { type = argus_rift_icecrown tier = 2 } }
				2764 = { has_great_project = { type = argus_rift_icecrown tier = 3 } }
			}
		}
		2764 = { add_canal = argus_rift_icecrown }
	}
	if = {
		limit = {
			OR = {
				2773 = { has_great_project = { type = argus_rift_hyjal tier = 1 } }
				2773 = { has_great_project = { type = argus_rift_hyjal tier = 2 } }
				2773 = { has_great_project = { type = argus_rift_hyjal tier = 3 } }
			}
		}
		2773 = { add_canal = argus_rift_hyjal }
	}
	if = {
		limit = {
			OR = {
				2769 = { has_great_project = { type = argus_rift_throne_of_kiljaeden tier = 1 } }
				2769 = { has_great_project = { type = argus_rift_throne_of_kiljaeden tier = 2 } }
				2769 = { has_great_project = { type = argus_rift_throne_of_kiljaeden tier = 3 } }
			}
		}
		2769 = { add_canal = argus_rift_throne_of_kiljaeden }
	}
	if = {
		limit = {
			OR = {
				2765 = { has_great_project = { type = argus_rift_throne_of_kiljaeden_draenor tier = 1 } }
				2765 = { has_great_project = { type = argus_rift_throne_of_kiljaeden_draenor tier = 2 } }
				2765 = { has_great_project = { type = argus_rift_throne_of_kiljaeden_draenor tier = 3 } }
			}
		}
		2765 = { add_canal = argus_rift_throne_of_kiljaeden_draenor }
	}
	if = {
		limit = {
			OR = {
				2772 = { has_great_project = { type = argus_rift_tomb_of_sargeras tier = 1 } }
				2772 = { has_great_project = { type = argus_rift_tomb_of_sargeras tier = 2 } }
				2772 = { has_great_project = { type = argus_rift_tomb_of_sargeras tier = 3 } }
			}
		}
		2772 = { add_canal = argus_rift_tomb_of_sargeras }
	}
	if = {
		limit = {
			OR = {
				4808 = { has_great_project = { type = oribos_rift_icecrown tier = 1 } }
				4808 = { has_great_project = { type = oribos_rift_icecrown tier = 2 } }
				4808 = { has_great_project = { type = oribos_rift_icecrown tier = 3 } }
			}
		}
		4808 = { add_canal = oribos_rift_icecrown }
	}
	if = {
		limit = {
			OR = {
				3220 = { has_great_project = { type = frozen_rift_brill tier = 1 } }
				3220 = { has_great_project = { type = frozen_rift_brill tier = 2 } }
				3220 = { has_great_project = { type = frozen_rift_brill tier = 3 } }
			}
		}
		3220 = { add_canal = frozen_rift_brill }
	}
	if = {
		limit = {
			OR = {
				3221 = { has_great_project = { type = frozen_rift_stratholme tier = 1 } }
				3221 = { has_great_project = { type = frozen_rift_stratholme tier = 2 } }
				3221 = { has_great_project = { type = frozen_rift_stratholme tier = 3 } }
			}
		}
		3221 = { add_canal = frozen_rift_stratholme }
	}
	if = {
		limit = {
			OR = {
				3227 = { has_great_project = { type = frozen_rift_andorhal tier = 1 } }
				3227 = { has_great_project = { type = frozen_rift_andorhal tier = 2 } }
				3227 = { has_great_project = { type = frozen_rift_andorhal tier = 3 } }
			}
		}
		3227 = { add_canal = frozen_rift_andorhal }
	}
	if = {
		limit = {
			OR = {
				1813 = { has_great_project = { type = mistfall_tunnel tier = 1 } }
				1813 = { has_great_project = { type = mistfall_tunnel tier = 2 } }
				1813 = { has_great_project = { type = mistfall_tunnel tier = 3 } }
			}
		}
		1813 = { add_canal = mistfall_tunnel }
	}
	if = {
		limit = {
			OR = {
				1665 = { has_great_project = { type = demonic_rift_conflagration tier = 1 } }
				1665 = { has_great_project = { type = demonic_rift_conflagration tier = 2 } }
				1665 = { has_great_project = { type = demonic_rift_conflagration tier = 3 } }
			}
		}
		1665 = { add_canal = demonic_rift_conflagration }
	}
	if = {
		limit = {
			OR = {
				1586 = { has_great_project = { type = dark_portal_outland tier = 1 } }
				1586 = { has_great_project = { type = dark_portal_outland tier = 2 } }
				1586 = { has_great_project = { type = dark_portal_outland tier = 3 } }
			}
		}
		1586 = { add_canal = dark_portal_outland }
	}
	if = {
		limit = {
			OR = {
				3792 = { has_great_project = { type = dark_portal_draenor tier = 1 } }
				3792 = { has_great_project = { type = dark_portal_draenor tier = 2 } }
				3792 = { has_great_project = { type = dark_portal_draenor tier = 3 } }
			}
		}
		3792 = { add_canal = dark_portal_draenor }
	}
}
