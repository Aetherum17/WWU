#-----------------------------------
# On Actions
#-----------------------------------
# VAWSER: update the state of Azjol Nerub's tunnel network based on their mission completion
on_monthly_pulse__azjol_nerub = {
    if = {
        limit = {
            OR = {
                tag = P74
                was_tag = P74
            }
        }
        
        every_owned_province = {
            limit = {
                NOT = { has_province_modifier = nerubian_tunnel_0 }
                culture_group = culture_group_nerubian
                development = 10
            }
            
            if = {
                limit = {
                    owner = { mission_completed = P74_encounter_the_vrykuls }
                    region = region_icecrown
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
            
            if = {
                limit = {
                    owner = { mission_completed = P74_encounter_the_dragons }
                    region = region_wintergrasp
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
            
            if = {
                limit = {
                    owner = { mission_completed = P74_encounter_the_tuskarrs }
                    region = region_borean_tundra
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
            
            if = {
                limit = {
                    owner = { has_country_flag = nerubian_one_four_extra }
                    region = region_sholazar_basin
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
            
            if = {
                limit = {
                    owner = { mission_completed = P74_fall_of_wyrmrest_temple }
                    region = region_dragonblight
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
            
            if = {
                limit = {
                    owner = { mission_completed = P74_the_nerubian_empire }
                    superregion = northrend_superregion
                }
                
                add_province_triggered_modifier = nerubian_tunnel_0
            }
        }
    }
}

on_yearly_pulse__azjol_nerub = {
    # Icecrown
    if = {
        limit = {
            has_country_flag = cultural_dominantion_icecrown
        }
        
        # Add Cultural Domination modifier
        region_icecrown = {
            limit = {
                owned_by = ROOT
                NOT = { culture = ROOT }
            }
            add_permanent_province_modifier = { 
                name = nerubian_convert_culture
                duration = -1
            }
        }
        
        # Tidy up the modifier if the province has been converted
        region_icecrown = {
            limit = {
                owned_by = ROOT
                culture = ROOT
                has_province_modifier = nerubian_convert_culture
            }
            remove_province_modifier = nerubian_convert_culture
        }
    }
    # Wintergrasp
    if = {
        limit = {
            has_country_flag = cultural_dominantion_wintergrasp
        }
        
        # Add Cultural Domination modifier
        region_wintergrasp = {
            limit = {
                owned_by = ROOT
                NOT = { culture = ROOT }
            }
            add_permanent_province_modifier = { 
                name = nerubian_convert_culture
                duration = -1
            }
        }
        
        # Tidy up the modifier if the province has been converted
        region_wintergrasp = {
            limit = {
                owned_by = ROOT
                culture = ROOT
                has_province_modifier = nerubian_convert_culture
            }
            remove_province_modifier = nerubian_convert_culture
        }
    }
    # Dragonblight
    if = {
        limit = {
            has_country_flag = cultural_dominantion_dragonblight
        }
        
        # Add Cultural Domination modifier
        region_dragonblight = {
            limit = {
                owned_by = ROOT
                NOT = { culture = ROOT }
            }
            add_permanent_province_modifier = { 
                name = nerubian_convert_culture
                duration = -1
            }
        }
        
        # Tidy up the modifier if the province has been converted
        region_dragonblight = {
            limit = {
                owned_by = ROOT
                culture = ROOT
                has_province_modifier = nerubian_convert_culture
            }
            remove_province_modifier = nerubian_convert_culture
        }
    }
    # Northrend
    if = {
        limit = {
            has_country_flag = cultural_dominantion_northrend
        }
        
        # Add Cultural Domination modifier
        northrend_superregion = {
            limit = {
                owned_by = ROOT
                NOT = { culture = ROOT }
            }
            add_permanent_province_modifier = { 
                name = nerubian_convert_culture
                duration = -1
            }
        }
        
        # Tidy up the modifier if the province has been converted
        northrend_superregion = {
            limit = {
                owned_by = ROOT
                culture = ROOT
                has_province_modifier = nerubian_convert_culture
            }
            remove_province_modifier = nerubian_convert_culture
        }
    }
    # Borean Tundra
    if = {
        limit = {
            has_country_flag = cultural_dominantion_borean_tundra
        }
        
        # Add Cultural Domination modifier
        region_borean_tundra = {
            limit = {
                owned_by = ROOT
                NOT = { culture = ROOT }
            }
            add_permanent_province_modifier = { 
                name = nerubian_convert_culture
                duration = -1
            }
        }
        
        # Tidy up the modifier if the province has been converted
        region_borean_tundra = {
            limit = {
                owned_by = ROOT
                culture = ROOT
                has_province_modifier = nerubian_convert_culture
            }
            remove_province_modifier = nerubian_convert_culture
        }
    }
}


#-----------------------------------
# Misc
#-----------------------------------
improve_nerubian_tunnel_province = {
    hidden_effect = {
        add_country_modifier = {
            name = dig_tunnel_cooldown
            duration = 365
        }
    }
    
    add_adm_power = -50
    add_dip_power = -50
    add_mil_power = -50
    
    if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 0
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_0
			add_province_triggered_modifier = nerubian_tunnel_1
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 1
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_1
			add_province_triggered_modifier = nerubian_tunnel_2
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 2
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_2
			add_province_triggered_modifier = nerubian_tunnel_3
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 3
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_3
			add_province_triggered_modifier = nerubian_tunnel_4
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 4
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_4
			add_province_triggered_modifier = nerubian_tunnel_5
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 5
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_5
			add_province_triggered_modifier = nerubian_tunnel_6
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 6
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_6
			add_province_triggered_modifier = nerubian_tunnel_7
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 7
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_7
			add_province_triggered_modifier = nerubian_tunnel_8
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 8
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_8
			add_province_triggered_modifier = nerubian_tunnel_9
        }
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 9
            }
        }
        
        $PROVINCE_ID$ = {
			remove_province_triggered_modifier = nerubian_tunnel_9
			add_province_triggered_modifier = nerubian_tunnel_10
        }
    }
    
    # Increment depth variable
    if = {
        limit = {
            NOT = {
                check_variable = {
                    which = nerubian_tunnel_$NUMBER$_depth
                    value = 10
                }
            }
        }
        change_variable = {
            which = nerubian_tunnel_$NUMBER$_depth
            value = 1
        }
    }
}

# VAWSER: 
select_combined_nerubian_knowledge_modifier = {
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_1"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_2"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_3"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_4"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_5"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_6"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_7"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_8"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_a
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_9"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_10"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_11"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_12"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_13"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_14"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_15"
            duration = -1  
        }
    }

    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_16"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_17"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_b
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_18"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_19"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_20"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_a
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_21"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_22"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_23"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_b
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_24"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_a
        }
        add_country_modifier = {
            name = "nerubian_archives_power_25"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_b
        }
        add_country_modifier = {
            name = "nerubian_archives_power_26"
            duration = -1  
        }
    }
    
    if = {
        limit = {
            has_country_flag = nerubian_tooltip_10_c
            has_country_flag = nerubian_tooltip_11_c
            has_country_flag = nerubian_tooltip_12_c
        }
        add_country_modifier = {
            name = "nerubian_archives_power_27"
            duration = -1  
        }
    }
}

show_tunnel_improvement_development_tooltip = {
    if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 0
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_1_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 1
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_2_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 2
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_3_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 3
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_4_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 4
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_5_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 5
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_6_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 6
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_7_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 7
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_8_TT
    }
    else_if = {
        limit = {
            is_variable_equal = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 8
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_9_TT
    }
    else_if = {
        limit = {
            check_variable = {
                which = nerubian_tunnel_$NUMBER$_depth
                value = 9
            }
        }
        custom_tooltip = NERUBIAN_DIG_PROVINCE_LACK_DEV_10_TT
    }
}
