# Unlock Interdimensional Invasion
unlock_interdimensional_invasion = {
    custom_tooltip = INTERDIMENSIONAL_INVASION_TT
    hidden_effect = {
        set_country_flag = unlocked_interdimensional_invasion
    }
}

#-----------------------------------
# On Actions
#-----------------------------------
# ROOT = Winning Country, FROM = Province
on_siege_won_country__invasion = {
    # Invasion - Add core to first province sieged
    if = {
        limit = {
            NOT = { has_country_flag = first_core_of_invasion }
            
            # Is one of the invader nations
            OR = {
                # Attacker
                is_in_war = {
                    casus_belli = cb_demonic_invasion
                    attackers = ROOT
                }
                is_in_war = {
                    casus_belli = cb_elemental_invasion
                    attackers = ROOT
                }
                is_in_war = {
                    casus_belli = cb_mawsworn_invasion
                    attackers = ROOT
                }
                is_in_war = {
                    casus_belli = cb_interdimensional_invasion
                    attackers = ROOT
                }
                # Defender
                is_in_war = {
                    casus_belli = cb_demonic_invasion
                    defenders = ROOT
                }
                is_in_war = {
                    casus_belli = cb_elemental_invasion
                    defenders = ROOT
                }
                is_in_war = {
                    casus_belli = cb_mawsworn_invasion
                    defenders = ROOT
                }
                is_in_war = {
                    casus_belli = cb_interdimensional_invasion
                    defenders = ROOT
                }
            }
            
            FROM = {
                NOT = { is_core = ROOT }
            }
        }
        
        set_country_flag = first_core_of_invasion
        
        FROM = {
            add_core = ROOT
        }
    }
}

# ROOT = Losing Country, FROM = Winning Country
on_war_lost__invasion = {
    # War ends - these should only apply if the war end causes the loser to end the war
    if = {
        limit = {
            is_at_war = no
        }
        
        # Reset Invasion flag
        clr_country_flag = invasion_spawn_done
        clr_country_flag = first_core_of_invasion
    }
}

# ROOT = Winning Country, FROM = Losing Country
on_war_won__invasion = {  
    # Reset Invasion flag
    clr_country_flag = invasion_spawn_done
    clr_country_flag = first_core_of_invasion
}