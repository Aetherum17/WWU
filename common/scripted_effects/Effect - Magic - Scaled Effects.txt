#------------------------
# Scaled Effects
#------------------------
# Adds modifier based on ruler Aptitude, with its duration determined by Concentration, and its potency by Finesse
add_scaled_spell_modifier = {    
    scaled_magic_modifier_effect = {
        MODIFIER_POOR       = $MODIFIER$_poor
        MODIFIER_COMMON     = $MODIFIER$_common
        MODIFIER_RARE       = $MODIFIER$_rare
        MODIFIER_EPIC       = $MODIFIER$_epic
        MODIFIER_LEGENDARY  = $MODIFIER$_legendary
    }
}

# ROOT is enemy, FROM is caster
apply_modifier_spell_enemy_effect = {    
    scaled_magic_modifier_enemy_effect = {
        MODIFIER_POOR       = $MODIFIER$_poor
        MODIFIER_COMMON     = $MODIFIER$_common
        MODIFIER_RARE       = $MODIFIER$_rare
        MODIFIER_EPIC       = $MODIFIER$_epic
        MODIFIER_LEGENDARY  = $MODIFIER$_legendary
    }
}

# ROOT = caster, FROM = enemy
scaled_magic_modifier_enemy_effect = {
    # Legendary
    if = {
        limit = {
            event_target:caster = { has_legendary_finesse = yes }
            event_target:victim = { NOT = { has_country_modifier = $MODIFIER_LEGENDARY$ } }
        }
        
        event_target:victim = { 
            add_country_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = -1
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            event_target:caster = { has_epic_finesse = yes }
            event_target:victim = { NOT = { has_country_modifier = $MODIFIER_EPIC$ } }
        }
        
        event_target:victim = { 
            add_country_modifier = {
                name = $MODIFIER_EPIC$
                duration = -1
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            event_target:caster = { has_rare_finesse = yes }
            event_target:victim = { NOT = { has_country_modifier = $MODIFIER_RARE$ } }
        }
        
        event_target:victim = { 
            add_country_modifier = {
                name = $MODIFIER_RARE$
                duration = -1
            }
        }
    }
    # Common
    else_if = {
        limit = {
            event_target:caster = { has_common_finesse = yes }
            event_target:victim = { NOT = { has_country_modifier = $MODIFIER_COMMON$ } }
        }
        
        event_target:victim = { 
            add_country_modifier = {
                name = $MODIFIER_COMMON$
                duration = -1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            event_target:caster = { has_poor_finesse = yes }
            event_target:victim = { NOT = { has_country_modifier = $MODIFIER_POOR$ } }
        }
        
        event_target:victim = { 
            add_country_modifier = {
                name = $MODIFIER_POOR$
                duration = -1
            }
        }
    }
}

# ROOT is province, FROM is caster
apply_modifier_spell_province_effect = {    
    scaled_magic_modifier_province_effect = {
        MODIFIER_POOR       = $MODIFIER$_prov_poor
        MODIFIER_COMMON     = $MODIFIER$_prov_common
        MODIFIER_RARE       = $MODIFIER$_prov_rare
        MODIFIER_EPIC       = $MODIFIER$_prov_epic
        MODIFIER_LEGENDARY  = $MODIFIER$_prov_legendary
    }
}

# ROOT = province, FROM = caster
scaled_magic_modifier_province_effect = {
    # Legendary
    if = {
        limit = {
            FROM = { has_legendary_finesse = yes }
        }
        
        if = {
            limit = {
                FROM = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                FROM = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                FROM = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                FROM = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                FROM = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 730
            }
        }
    }
    # Epic
    else_if = {
        limit = {
           FROM = { has_epic_finesse = yes }
        }
        
        if = {
            limit = {
                FROM = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_EPIC$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                FROM = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_EPIC$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                FROM = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_EPIC$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                FROM = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_EPIC$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                FROM = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_EPIC$
                duration = 730
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            FROM = { has_rare_finesse = yes }
        }
        
        if = {
            limit = {
                FROM = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_RARE$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                FROM = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_RARE$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                FROM = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_RARE$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                FROM = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_RARE$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                FROM = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_RARE$
                duration = 730
            }
        }
    }
    # Common
    else_if = {
        limit = {
            FROM = { has_common_finesse = yes }
        }
        
        if = {
            limit = {
                FROM = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_COMMON$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                FROM = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_COMMON$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                FROM = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_COMMON$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                FROM = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_COMMON$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                FROM = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_COMMON$
                duration = 730
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            FROM = { has_poor_finesse = yes }
        }
        
        if = {
            limit = {
                FROM = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_POOR$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                FROM = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_POOR$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                FROM = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_POOR$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                FROM = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_POOR$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                FROM = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER_POOR$
                duration = 730
            }
        }
    }
}

# ROOT = country, THIS = province
scaled_magic_modifier_country_province_effect = {
    # Legendary
    if = {
        limit = {
            ROOT = { has_legendary_finesse = yes }
        }
        
        if = {
            limit = {
                ROOT = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_legendary
                duration = 3650
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_legendary
                duration = 2920
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_legendary
                duration = 2190
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_legendary
                duration = 1460
            }
        }
        else_if = {
            limit = {
                ROOT = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_legendary
                duration = 730
            }
        }
    }
    # Epic
    else_if = {
        limit = {
           ROOT = { has_epic_finesse = yes }
        }
        
        if = {
            limit = {
                ROOT = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_epic
                duration = 3650
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_epic
                duration = 2920
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_epic
                duration = 2190
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_epic
                duration = 1460
            }
        }
        else_if = {
            limit = {
                ROOT = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_epic
                duration = 730
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            ROOT = { has_rare_finesse = yes }
        }
        
        if = {
            limit = {
                ROOT = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_rare
                duration = 3650
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_rare
                duration = 2920
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_rare
                duration = 2190
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_rare
                duration = 1460
            }
        }
        else_if = {
            limit = {
                ROOT = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_rare
                duration = 730
            }
        }
    }
    # Common
    else_if = {
        limit = {
            ROOT = { has_common_finesse = yes }
        }
        
        if = {
            limit = {
                ROOT = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_common
                duration = 3650
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_common
                duration = 2920
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_common
                duration = 2190
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_common
                duration = 1460
            }
        }
        else_if = {
            limit = {
                ROOT = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_common
                duration = 730
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            ROOT = { has_poor_finesse = yes }
        }
        
        if = {
            limit = {
                ROOT = { has_legendary_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_poor
                duration = 3650
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_poor
                duration = 2920
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_poor
                duration = 2190
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_poor
                duration = 1460
            }
        }
        else_if = {
            limit = {
                ROOT = { has_poor_concentration = yes }
            }
            add_province_modifier = {
                name = $MODIFIER$_poor
                duration = 730
            }
        }
    }
}

scaled_magic_timer_tooltip_effect = {
    if = {
        limit = {
            has_legendary_concentration = yes
        }
        
        custom_tooltip = $TOOLTIP_LEGENDARY$
    }
    else_if = {
        limit = {
            has_epic_concentration = yes
        }
        
        custom_tooltip = $TOOLTIP_EPIC$
    }
    else_if = {
        limit = {
            has_rare_concentration = yes
        }
        
        custom_tooltip = $TOOLTIP_RARE$
    }
    else_if = {
        limit = {
            has_common_concentration = yes
        }
        
        custom_tooltip = $TOOLTIP_COMMON$
    }
    else_if = {
        limit = {
            has_poor_concentration = yes
        }
        
        custom_tooltip = $TOOLTIP_POOR$
    }
}

scaled_magic_modifier_timer_effect = {
    if = {
        limit = {
            has_legendary_concentration = yes
        }
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $TIME_LEGENDARY$
        }
    }
    else_if = {
        limit = {
            has_epic_concentration = yes
        }
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $TIME_EPIC$
        }
    }
    else_if = {
        limit = {
            has_rare_concentration = yes
        }
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $TIME_RARE$
        }
    }
    else_if = {
        limit = {
            has_common_concentration = yes
        }
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $TIME_COMMON$
        }
    }
    else_if = {
        limit = {
            has_poor_concentration = yes
        }
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $TIME_POOR$
        }
    }
}

#------------------------
# Utility
#------------------------
scaled_magic_modifier_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        if = {
            limit = {
                has_legendary_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                has_epic_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                has_rare_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                has_common_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                has_poor_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_LEGENDARY$
                duration = 730
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        if = {
            limit = {
                has_legendary_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_EPIC$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                has_epic_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_EPIC$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                has_rare_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_EPIC$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                has_common_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_EPIC$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                has_poor_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_EPIC$
                duration = 730
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        if = {
            limit = {
                has_legendary_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_RARE$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                has_epic_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_RARE$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                has_rare_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_RARE$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                has_common_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_RARE$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                has_poor_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_RARE$
                duration = 730
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        if = {
            limit = {
                has_legendary_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_COMMON$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                has_epic_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_COMMON$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                has_rare_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_COMMON$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                has_common_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_COMMON$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                has_poor_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_COMMON$
                duration = 730
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        if = {
            limit = {
                has_legendary_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_POOR$
                duration = 3650
            }
        }
        else_if = {
            limit = {
                has_epic_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_POOR$
                duration = 2920
            }
        }
        else_if = {
            limit = {
                has_rare_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_POOR$
                duration = 2190
            }
        }
        else_if = {
            limit = {
                has_common_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_POOR$
                duration = 1460
            }
        }
        else_if = {
            limit = {
                has_poor_concentration = yes
            }
            add_ruler_modifier = {
                name = $MODIFIER_POOR$
                duration = 730
            }
        }
    }
}

evocation_cooldown_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_concentration = yes
        }
        
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $DURATION_LEGENDARY$
            hidden = yes
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_concentration = yes
        }
        
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $DURATION_EPIC$
            hidden = yes
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_concentration = yes
        }
        
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $DURATION_RARE$
            hidden = yes
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_concentration = yes
        }
        
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $DURATION_COMMON$
            hidden = yes
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_concentration = yes
        }
        
        add_ruler_modifier = {
            name = $MODIFIER$
            duration = $DURATION_POOR$
            hidden = yes
        }
    }
}

# Adds treasury based on ruler Finesse
scaled_spell_effect__add_treasury = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_treasury = 500
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_treasury = 400
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_treasury = 300
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_treasury = 200
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_treasury = 100
    }
}

# Adds years of income based on ruler Finesse
years_of_income_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_years_of_income = 2.5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_years_of_income = 2.1
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_years_of_income = 1.7
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_years_of_income = 1.3
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_years_of_income = 1
    }
}

# Remove inflation based on ruler Finesse
remove_inflation_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_inflation = -5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_inflation = -4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_inflation = -3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_inflation = -2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_inflation = -1
    }
}

# Add mercantilism based on ruler Finesse
mercantilism_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_mercantilism = 5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_mercantilism = 4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_mercantilism = 3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_mercantilism = 2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_mercantilism = 1
    }
}

# Adds ADM power based on ruler Finesse
adm_power_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_adm_power = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_adm_power = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_adm_power = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_adm_power = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_adm_power = 20
    }
}

# Adds DIP power based on ruler Finesse
dip_power_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_dip_power = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_dip_power = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_dip_power = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_dip_power = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_dip_power = 20
    }
}

# Adds MIL power based on ruler Finesse
mil_power_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_mil_power = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_mil_power = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_mil_power = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_mil_power = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_mil_power = 20
    }
}

scaled_spell_effect__add_monarch_power = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_adm_power = 100
        add_dip_power = 100
        add_mil_power = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_adm_power = 80
        add_dip_power = 80
        add_mil_power = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_adm_power = 60
        add_dip_power = 60
        add_mil_power = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_adm_power = 40
        add_dip_power = 40
        add_mil_power = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_adm_power = 20
        add_dip_power = 20
        add_mil_power = 20
    }
}

# Adds ADM/DIP/MIL power based on ruler Finesse (weak)
weak_monarch_power_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_adm_power = 50
        add_dip_power = 50
        add_mil_power = 50
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_adm_power = 40
        add_dip_power = 40
        add_mil_power = 40
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_adm_power = 30
        add_dip_power = 30
        add_mil_power = 30
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_adm_power = 20
        add_dip_power = 20
        add_mil_power = 20
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_adm_power = 10
        add_dip_power = 10
        add_mil_power = 10
    }
}

scaled_spell_effect__subtract_corruption = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_corruption = -5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_corruption = -4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_corruption = -3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_corruption = -2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_corruption = -1
    }
}

scaled_spell_effect__add_prestige = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_prestige = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_prestige = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_prestige = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_prestige = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_prestige = 5
    }
}

scaled_spell_effect__add_random_tech = {
    # Display the normal random list effect
    tooltip = {
        random_list = {
            33 = {
                add_adm_tech = 1
            }
            33 = {
                add_dip_tech = 1
            }
            33 = {
                add_mil_tech = 1
            }
        }
    }
    
    # Actually use the random flags to determine the result
    hidden_effect = {
        if = {
            limit = {
                OR = {
                    has_country_flag = random_flag_0
                    has_country_flag = random_flag_1
                    has_country_flag = random_flag_2
                }
            }
            
            add_adm_tech = 1
        }
        else_if = {
            limit = {
                OR = {
                    has_country_flag = random_flag_3
                    has_country_flag = random_flag_4
                    has_country_flag = random_flag_5
                }
            }
            
            add_dip_tech = 1
        }
        else_if = {
            limit = {
                OR = {
                    has_country_flag = random_flag_6
                    has_country_flag = random_flag_7
                    has_country_flag = random_flag_8
                    has_country_flag = random_flag_9
                }
            }
            
            add_mil_tech = 1
        }
    }
}

# Adds Splendor based on ruler Finesse
scaled_spell_effect__add_splendor = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_splendor = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_splendor = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_splendor = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_splendor = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_splendor = 20
    }
}

scaled_spell_effect__add_stability = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        if = {
            limit = {
                NOT = { stability = 0 }
            }
            add_stability = 2
        }
        else = {
            add_stability = 1
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        if = {
            limit = {
                NOT = { stability = -1 }
            }
            add_stability = 2
        }
        else = {
            add_stability = 1
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        if = {
            limit = {
                NOT = { stability = -2 }
            }
            add_stability = 2
        }
        else = {
            add_stability = 1
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_stability = 1
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_stability = 1
    }
}

scaled_spell_effect__subtract_war_exhaustion = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_war_exhaustion = -5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_war_exhaustion = -4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_war_exhaustion = -3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_war_exhaustion = -2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_war_exhaustion = -1
    }
}

# Adds Army Tradition based on ruler Finesse
army_tradition_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_army_tradition = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_army_tradition = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_army_tradition = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_army_tradition = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_army_tradition = 5
    }
}

# Adds Navy Tradition based on ruler Finesse
navy_tradition_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_navy_tradition = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_navy_tradition = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_navy_tradition = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_navy_tradition = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_navy_tradition = 5
    }
}

# Adds Army Professionalism based on ruler Finesse
army_professionalism_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_army_professionalism = 0.1
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_army_professionalism = 0.08
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_army_professionalism = 0.06
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_army_professionalism = 0.04
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_army_professionalism = 0.02
    }
}

# Adds Manpower based on ruler Finesse
manpower_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_manpower = 10
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_manpower = 8
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_manpower = 6
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_manpower = 4
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_manpower = 2
    }
}

scaled_spell_effect__add_yearly_manpower = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_yearly_manpower = 5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_yearly_manpower = 4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_yearly_manpower = 3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_yearly_manpower = 2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_yearly_manpower = 1
    }
}

# Adds Sailors based on ruler Finesse
sailors_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_sailors = 10
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_sailors = 8
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_sailors = 6
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_sailors = 4
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_sailors = 2
    }
}

scaled_spell_effect__add_yearly_sailors = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_yearly_sailors = 5
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_yearly_sailors = 4
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_yearly_sailors = 3
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_yearly_sailors = 2
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_yearly_sailors = 1
    }
}

# Adds Absolutism based on ruler Finesse
absolutism_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_absolutism = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_absolutism = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_absolutism = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_absolutism = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_absolutism = 5
    }
}

scaled_spell_effect__add_legitimacy = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_legitimacy = 25
        add_republican_tradition = 25
        add_devotion = 25
        add_horde_unity = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_legitimacy = 20
        add_republican_tradition = 20
        add_devotion = 20
        add_horde_unity = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_legitimacy = 15
        add_republican_tradition = 15
        add_devotion = 15
        add_horde_unity = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_legitimacy = 10
        add_republican_tradition = 10
        add_devotion = 10
        add_horde_unity = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_legitimacy = 5
        add_republican_tradition = 5
        add_devotion = 5
        add_horde_unity = 5
    }
}

# Adds Meritocracy based on ruler Finesse
meritocracy_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_meritocracy = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_meritocracy = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_meritocracy = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_meritocracy = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_meritocracy = 5
    }
}

scaled_spell_effect__add_reform_progress = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        change_government_reform_progress = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        change_government_reform_progress = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        change_government_reform_progress = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        change_government_reform_progress = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        change_government_reform_progress = 20
    }
}

# Adds Religious Power based on ruler Finesse
#   Undead
#   Shadow
#   Old God
religious_power_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_church_power = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_church_power = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_church_power = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_church_power = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_church_power = 20
    }
}

# Adds Elemental Attunement based on ruler Finesse
elemental_attunement_gain_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_karma = 25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_karma = 20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_karma = 15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_karma = 10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_karma = 5
    }
}

# Removes Elemental Attunement based on ruler Finesse
elemental_attunement_loss_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_karma = -25
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_karma = -20
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_karma = -15
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_karma = -10
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_karma = -5
    }
}

# Adds Unholy Influence based on ruler Finesse
unholy_influence_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_papal_influence = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_papal_influence = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_papal_influence = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_papal_influence = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_papal_influence = 20
    }
}

# Adds Harmony based on ruler Finesse
harmony_spell_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_harmony = 100
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_harmony = 80
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_harmony = 60
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_harmony = 40
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_harmony = 20
    }
}

#-----------------------------
# UNUSED
#-----------------------------
# Ascendance
ascendance_effect = {
    define_general = {
        name = "Ascended Commander"
        fire = 10
        shock = 10
        manuever = 10
        siege = 10
    }
    
    country_event = { id = wwu_magic_effect.1 days = 3650 }
}

# Evocation
evocation_effect = {
    add_corruption = 2
    
    custom_tooltip = EVOCATION_TT
    
    hidden_effect = {
        evocation_cooldown_effect = {
            MODIFIER            = evocation_cooldown
            DURATION_POOR       = 1825
            DURATION_COMMON     = 1460
            DURATION_RARE       = 1095
            DURATION_EPIC       = 730
            DURATION_LEGENDARY  = 365
        }
    }
}

expel_harm_effect = {
    random_owned_province = {
        spawn_rebels = {
            type = pretender_rebels
            size = 1
        }
    }
    
    custom_tooltip = EVOCATION_TT # This can be used for all types of evocation
    
    hidden_effect = {
        evocation_cooldown_effect = {
            MODIFIER            = expel_harm_cooldown
            DURATION_POOR       = 1825
            DURATION_COMMON     = 1460
            DURATION_RARE       = 1095
            DURATION_EPIC       = 730
            DURATION_LEGENDARY  = 365
        }
    }
}

chi_burst_effect = {
    every_owned_province = {
        limit = {
            has_siege = yes
        }
        kill_units = {
            who = enemy
        }
    }
}

touch_of_death_effect = {
    custom_tooltip = TOUCH_OF_DEATH_TT
    
    hidden_effect = {
        set_country_flag = touch_of_death
    }
}

sacrifice_victims_effect = {
    add_yearly_manpower = -0.5
    
    custom_tooltip = EVOCATION_TT
    
    hidden_effect = {
        evocation_cooldown_effect = {
            MODIFIER            = evocation_cooldown
            DURATION_POOR       = 1825
            DURATION_COMMON     = 1460
            DURATION_RARE       = 1095
            DURATION_EPIC       = 730
            DURATION_LEGENDARY  = 365
        }
    }
}

curse_of_weakness_effect = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = CURSE_OF_WEAKNESS_5_EFFECT_TT
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = CURSE_OF_WEAKNESS_4_EFFECT_TT
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = CURSE_OF_WEAKNESS_3_EFFECT_TT
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = CURSE_OF_WEAKNESS_2_EFFECT_TT
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = CURSE_OF_WEAKNESS_1_EFFECT_TT
    }
}

drain_power_effect = {
    custom_tooltip = KILL_ENEMY_UNITS_IN_COUNTRY_TT
    
    hidden_effect = {
        every_owned_province = {
            kill_units = {
                who = enemy
            }
        }
    }
}


resurrect_dire_troll_effect = {
    custom_tooltip = RESURRECT_DIRE_TROLL_EFFECT_TT
    
    hidden_effect = {
        # Legendary
        if = {
            limit = {
                has_legendary_finesse = yes
            }
            
            define_general = {
                name = "Dire Troll"
                fire = 6
                shock = 6
                manuever = 6
                siege = 6
            }
        }
        # Epic
        else_if = {
            limit = {
                has_epic_finesse = yes
            }
            
            define_general = {
                name = "Dire Troll"
                fire = 5
                shock = 5
                manuever = 5
                siege = 5
            }
        }
        # Rare
        else_if = {
            limit = {
                has_rare_finesse = yes
            }
            
            define_general = {
                name = "Dire Troll"
                fire = 4
                shock = 4
                manuever = 4
                siege = 4
            }
        }
        # Common
        else_if = {
            limit = {
                has_common_finesse = yes
            }
            
            define_general = {
                name = "Dire Troll"
                fire = 3
                shock = 3
                manuever = 3
                siege = 4
            }
        }
        # Poor
        else_if = {
            limit = {
                has_poor_finesse = yes
            }
            
            define_general = {
                name = "Dire Troll"
                fire = 2
                shock = 2
                manuever = 2
                siege = 4
            }
        }
    }
}

#-----------------------------
# Unique Scaled Effects
#-----------------------------
# Polymorph
scaled_spell_effect__polymorph = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        hidden_effect = {
            set_variable = {
                which = polymorph_count
                value = 5
            }
            set_country_flag = polymorph_active
        }
        
        custom_tooltip = POLYMORPH_EFFECT
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        hidden_effect = {
            set_variable = {
                which = polymorph_count
                value = 4
            }
            set_country_flag = polymorph_active
        }
        
        custom_tooltip = POLYMORPH_EFFECT
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        hidden_effect = {
            set_variable = {
                which = polymorph_count
                value = 3
            }
            set_country_flag = polymorph_active
        }
        
        custom_tooltip = POLYMORPH_EFFECT
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        hidden_effect = {
            set_variable = {
                which = polymorph_count
                value = 2
            }
            set_country_flag = polymorph_active
        }
        
        custom_tooltip = POLYMORPH_EFFECT
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        hidden_effect = {
            set_variable = {
                which = polymorph_count
                value = 1
            }
            set_country_flag = polymorph_active
        }
        
        custom_tooltip = POLYMORPH_EFFECT
    }
}

# Judgment
scaled_spell_effect__judgment = {
    custom_tooltip = KILL_ENEMY_UNITS_IN_COUNTRY_TT
    
    hidden_effect = {
        every_owned_province = {
            kill_units = {
                who = enemy
            }
        }
    }
}

# Avatar of the Light
scaled_spell_effect__avatar_of_the_light = {
    define_general = {
        name = "Avatar of the Light"
        fire = 6
        shock = 6
        manuever = 6
        siege = 6
    }
    
    country_event = { id = wwu_magic_effect.2 days = 9125 } # 25 years
}

# Ring of Peace
scaled_spell_effect__ring_of_peace = {
    if = {
        limit = {
            has_legendary_concentration = yes
        }
        
        custom_tooltip = PREVENT_WAR_TT_10
        hidden_effect = {
            add_ruler_modifier = {
                name = chi_prevent_war
                duration = 3650
                hidden = yes
            }
        }
    }
    else_if = {
        limit = {
            has_epic_concentration = yes
        }
        
        custom_tooltip = PREVENT_WAR_TT_8
        hidden_effect = {
            add_ruler_modifier = {
                name = chi_prevent_war
                duration = 2920
                hidden = yes
            }
        }
    }
    else_if = {
        limit = {
            has_rare_concentration = yes
        }
        
        custom_tooltip = PREVENT_WAR_TT_6
        hidden_effect = {
            add_ruler_modifier = {
                name = chi_prevent_war
                duration = 2190
                hidden = yes
            }
        }
    }
    else_if = {
        limit = {
            has_common_concentration = yes
        }
        
        custom_tooltip = PREVENT_WAR_TT_4
        hidden_effect = {
            add_ruler_modifier = {
                name = chi_prevent_war
                duration = 1460
                hidden = yes
            }
        }
    }
    else_if = {
        limit = {
            has_poor_concentration = yes
        }
        
        custom_tooltip = PREVENT_WAR_TT_2
        hidden_effect = {
            add_ruler_modifier = {
                name = chi_prevent_war
                duration = 730
                hidden = yes
            }
        }
    }
}

# Mass Hex
scaled_spell_effect__mass_hex = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = MASS_HEX_EFFECT_5_TT
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = MASS_HEX_EFFECT_4_TT
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = MASS_HEX_EFFECT_3_TT
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = MASS_HEX_EFFECT_2_TT
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = MASS_HEX_EFFECT_1_TT
    }

    
    hidden_effect = {
        # Legendary
        if = {
            limit = {
                has_legendary_finesse = yes
            }
            
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
        }
        # Epic
        else_if = {
            limit = {
                has_epic_finesse = yes
            }
            
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
        }
        # Rare
        else_if = {
            limit = {
                has_rare_finesse = yes
            }
            
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
        }
        # Common
        else_if = {
            limit = {
                has_common_finesse = yes
            }
            
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
        }
        # Poor
        else_if = {
            limit = {
                has_poor_finesse = yes
            }
            
            random_owned_province = {
                limit = {
                    NOT = { religion = ROOT }
                }
                
                change_religion = ROOT
            }
        }
    }
}

# Big Bad Voodoo
scaled_spell_effect__big_bad_voodoo = {
    custom_tooltip = BIG_BAD_VOODOO_EFFECT_TT
    
    hidden_effect = {
        every_owned_province = {
            limit = {
                NOT = { is_core = ROOT }
            }
            
            add_core = ROOT
        }
    }
}

# Entangling Roots
scaled_spell_effect__entangling_roots = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_ENTANGLING_ROOTS_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_entangling_roots_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_ENTANGLING_ROOTS_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_entangling_roots_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_ENTANGLING_ROOTS_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_entangling_roots_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_ENTANGLING_ROOTS_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_entangling_roots_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_ENTANGLING_ROOTS_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_entangling_roots_token
                value = 1
            }
        }
    }
}
token_spell_effect__entangling_roots = {
    apply_modifier_spell_province_effect = {
        MODIFIER = entangling_roots
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_entangling_roots_token
                value = 1
            }   
        }
    }
}

# Death and Decay
scaled_spell_effect__death_and_decay = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_DEATH_AND_DECAY_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_death_and_decay_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_DEATH_AND_DECAY_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_death_and_decay_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_DEATH_AND_DECAY_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_death_and_decay_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_DEATH_AND_DECAY_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_death_and_decay_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_DEATH_AND_DECAY_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_death_and_decay_token
                value = 1
            }
        }
    }
}
token_spell_effect__death_and_decay = {
    apply_modifier_spell_province_effect = {
        MODIFIER = death_and_decay
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_death_and_decay_token
                value = 1
            }   
        }
    }
}

# Pestilence
scaled_spell_effect__pestilence = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_PESTILENCE_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_pestilence_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_PESTILENCE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_pestilence_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_PESTILENCE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_pestilence_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_PESTILENCE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_pestilence_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_PESTILENCE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_pestilence_token
                value = 1
            }
        }
    }
}
token_spell_effect__pestilence = {
    apply_modifier_spell_province_effect = {
        MODIFIER = pestilence
    }
    
    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_pestilence_token
                value = 1
            }   
        }
    }
}

# Raise Undead
scaled_spell_effect__raise_undead = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_100_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 1.0 }
            }
            
            add_manpower = 1.0
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_95_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.95 }
            }
            
            add_manpower = 1.0
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_90_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.9 }
            }
            
            add_manpower = 1.0
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_85_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.85 }
            }
            
            add_manpower = 1.0
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_80_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.8 }
            }
            
            add_manpower = 1.0
        }
    }
}

# Volcanic Rupture
scaled_spell_effect__volcanic_rupture = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_VOLCANIC_RUPTURE_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_volcanic_rupture_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_VOLCANIC_RUPTURE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_volcanic_rupture_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_VOLCANIC_RUPTURE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_volcanic_rupture_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_VOLCANIC_RUPTURE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_volcanic_rupture_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_VOLCANIC_RUPTURE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_volcanic_rupture_token
                value = 1
            }
        }
    }
}
token_spell_effect__volcanic_rupture = {
    add_devastation = 80
    area = {
        add_devastation = 25
    }
    
    area = {
        apply_modifier_spell_province_effect = {
            MODIFIER = volcanic_rupture
        }
    }
    
    # Development Loss
    if = {
        limit = {
            base_tax = 2
        }
        
        add_base_tax = -1
    }
    if = {
        limit = {
            base_production = 2
        }
        
        add_base_production = -1
    }
    if = {
        limit = {
            base_manpower = 2
        }
        
        add_base_manpower = -1
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_volcanic_rupture_token
                value = 1
            }   
        }
    }
}

# Healing Rain
scaled_spell_effect__healing_rain = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_100_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 1.0 }
            }
            
            add_manpower = 1.0
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_95_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.95 }
            }
            
            add_manpower = 1.0
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_90_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.9 }
            }
            
            add_manpower = 1.0
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_85_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.85 }
            }
            
            add_manpower = 1.0
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_80_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.8 }
            }
            
            add_manpower = 1.0
        }
    }
}

# Static Charge
scaled_spell_effect__static_charge = {
    custom_tooltip = STATIC_CHARGE_ENEMY_EFFECT_TT
}

static_charge_effect = {
    if = {
        limit = {
            owner = {
                OR = {
                    has_country_modifier = static_charge_poor
                    has_country_modifier = static_charge_common
                    has_country_modifier = static_charge_rare
                    has_country_modifier = static_charge_epic
                    has_country_modifier = static_charge_legendary
                }
            }
            
            # Don't trigger for self-sieges
            controller = {
                NOT = { tag = FROM }
            }
        }
        
        kill_units = {
            who = enemy
            amount = 5
        }
    }
}

# Earthquake
scaled_spell_effect__earthquake = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_EARTHQUAKE_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_earthquake_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_EARTHQUAKE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_earthquake_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_EARTHQUAKE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_earthquake_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_EARTHQUAKE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_earthquake_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_EARTHQUAKE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_earthquake_token
                value = 1
            }
        }
    }
}
token_spell_effect__earthquake = {
    area = {
        add_devastation = 50
    }
    
    area = {
        apply_modifier_spell_province_effect = {
            MODIFIER = earthquake
        }
    }
    
    custom_tooltip = EARTHQUAKE_EFFECT_TT
    hidden_effect = {
        if = {
            limit = {
                FROM = { 
                    has_legendary_finesse = yes
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                        has_country_flag = random_flag_3
                        has_country_flag = random_flag_4
                    }
                }
            }
            
            remove_all_buildings = yes
        }
        else_if = {
            limit = {
                FROM = { 
                    has_epic_finesse = yes
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                        has_country_flag = random_flag_3
                    }
                }
            }
            
            remove_all_buildings = yes
        }
        else_if = {
            limit = {
                FROM = { 
                    has_rare_finesse = yes
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                    }
                }
            }
            
            remove_all_buildings = yes
        }
        else_if = {
            limit = {
                FROM = { 
                    has_common_finesse = yes
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                    }
                }
            }
            
            remove_all_buildings = yes
        }
        else_if = {
            limit = {
                FROM = { 
                    has_poor_finesse = yes
                    OR = {
                        has_country_flag = random_flag_0
                    }
                }
            }
            
            remove_all_buildings = yes
        }
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_earthquake_token
                value = 1
            }   
        }
    }
}

# Hellfire
scaled_spell_effect__hellfire = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_HELLFIRE_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_hellfire_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_HELLFIRE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_hellfire_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_HELLFIRE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_hellfire_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_HELLFIRE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_hellfire_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_HELLFIRE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_hellfire_token
                value = 1
            }
        }
    }
}
token_spell_effect__hellfire = {
    add_devastation = 25

    apply_modifier_spell_province_effect = {
        MODIFIER = hellfire
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_hellfire_token
                value = 1
            }   
        }
    }
}

# Howl of Terror
scaled_spell_effect__howl_of_terror = {
    if = {
        limit = {
            is_at_war = no
        }
        
        custom_tooltip = HOWL_OF_TERROR_EFFECT_TT
    }

    every_war_enemy_country = {
        if = {
            limit = {
                ROOT = { has_legendary_finesse = yes }
            }
            
            add_country_modifier = {
                name = howl_of_terror_legendary
                duration = 1800
            }
        }
        else_if = {
            limit = {
                ROOT = { has_epic_finesse = yes }
            }
            add_country_modifier = {
                name = howl_of_terror_epic
                duration = 1800
            }
        }
        else_if = {
            limit = {
                ROOT = { has_rare_finesse = yes }
            }
            add_country_modifier = {
                name = howl_of_terror_rare
                duration = 1800
            }
        }
        else_if = {
            limit = {
                ROOT = { has_common_finesse = yes }
            }
            add_country_modifier = {
                name = howl_of_terror_common
                duration = 1800
            }
        }
        else = {
            add_country_modifier = {
                name = howl_of_terror_poor
                duration = 1800
            }
        }
    }
}

# Banish
scaled_spell_effect__banish = {
    if = {
        limit = {
            is_at_war = no
        }
        
        custom_tooltip = BANISH_EFFECT_TT
    }
    
    every_war_enemy_country = {
        custom_tooltip = BANISH_ENEMY_ARMY_TT
        
        hidden_effect = {
            ROOT = {
                random_owned_province = {
                    limit = {
                        units_in_province = PREV
                    }
                    save_event_target_as = chosen_start_portal
                }
            }
            capital_scope = {
                save_event_target_as = chosen_end_portal
            }
            teleport_unit_with_any_amount = yes
        }
    }
}

# Living Flame
scaled_spell_effect__living_flame = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_LIVING_FLAME_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_living_flame_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_LIVING_FLAME_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_living_flame_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_LIVING_FLAME_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_living_flame_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_LIVING_FLAME_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_living_flame_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_LIVING_FLAME_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_living_flame_token
                value = 1
            }
        }
    }
}
token_spell_effect__living_flame = {
    area = {
        apply_modifier_spell_province_effect = {
            MODIFIER = living_flame
        }
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_living_flame_token
                value = 1
            }   
        }
    }
}

# Ephemeral Dream
scaled_spell_effect__ephemeral_dream = {
    custom_tooltip = ENEMY_WAR_BLOCKED_TT
}

# Whisper of Despair
scaled_spell_effect__whisper_of_despair = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_WHISPER_OF_DESPAIR_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_whisper_of_despair_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_WHISPER_OF_DESPAIR_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_whisper_of_despair_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_WHISPER_OF_DESPAIR_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_whisper_of_despair_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_WHISPER_OF_DESPAIR_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_whisper_of_despair_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_WHISPER_OF_DESPAIR_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_whisper_of_despair_token
                value = 1
            }
        }
    }
}
token_spell_effect__whisper_of_despair = {
    change_religion = FROM

    apply_modifier_spell_province_effect = {
        MODIFIER = whisper_of_despair
    }
    
    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_whisper_of_despair_token
                value = 1
            }   
        }
    }
}

# Call of the Faceless
scaled_spell_effect__call_of_the_faceless = {
    custom_tooltip = FACELESS_COMMANDER_TT
    
    hidden_effect = {
        if = {
            limit = {
                has_legendary_finesse = yes
            }
            
            if = {
                limit = {
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                        has_country_flag = random_flag_3
                        has_country_flag = random_flag_4
                    }
                }
                define_general = {
                    name = "C'Thraxi Herald"
                    shock = 6
                    fire = 6
                    manuever = 4
                    siege = 10
                }
            }
            else = {
                create_general = {
                    tradition = 100
                }
            }
        }
        else_if = {
            limit = {
                has_epic_finesse = yes
            }
            
            if = {
                limit = {
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                        has_country_flag = random_flag_3
                    }
                }
                define_general = {
                    name = "C'Thraxi Herald"
                    shock = 6
                    fire = 6
                    manuever = 4
                    siege = 10
                }
            }
            else = {
                create_general = {
                    tradition = 95
                }
            }
        }
        else_if = {
            limit = {
                has_rare_finesse = yes
            }
            
            if = {
                limit = {
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                        has_country_flag = random_flag_2
                    }
                }
                define_general = {
                    name = "C'Thraxi Herald"
                    shock = 6
                    fire = 6
                    manuever = 4
                    siege = 10
                }
            }
            else = {
                create_general = {
                    tradition = 90
                }
            }
        }
        else_if = {
            limit = {
                has_common_finesse = yes
            }
            
            if = {
                limit = {
                    OR = {
                        has_country_flag = random_flag_0
                        has_country_flag = random_flag_1
                    }
                }
                define_general = {
                    name = "C'Thraxi Herald"
                    shock = 5
                    fire = 5
                    manuever = 4
                    siege = 8
                }
            }
            else = {
                create_general = {
                    tradition = 85
                }
            }
        }
        else_if = {
            limit = {
                has_poor_finesse = yes
            }
            
            if = {
                limit = {
                    OR = {
                        has_country_flag = random_flag_0
                    }
                }
                define_general = {
                    name = "C'Thraxi Herald"
                    shock = 5
                    fire = 5
                    manuever = 4
                    siege = 8
                }
            }
            else = {
                create_general = {
                    tradition = 80
                }
            }
        }
    }
}

# Corrupting Influence
scaled_spell_effect__corrupting_influence = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        every_neighbor_country = {
            limit = {
                NOT = { 
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                }
            }
            
            add_corruption = 10
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        every_neighbor_country = {
            limit = {
                NOT = { 
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                }
            }
            
            add_corruption = 8
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        every_neighbor_country = {
            limit = {
                NOT = { 
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                }
            }
            
            add_corruption = 6
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        every_neighbor_country = {
            limit = {
                NOT = { 
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                }
            }
            
            add_corruption = 4
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        every_neighbor_country = {
            limit = {
                NOT = { 
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                }
            }
            
            add_corruption = 2
        }
    }
}

# Mind Control
scaled_spell_effect__mind_control = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_MIND_CONTROL_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_mind_control_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_MIND_CONTROL_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_mind_control_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_MIND_CONTROL_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_mind_control_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_MIND_CONTROL_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_mind_control_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_MIND_CONTROL_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_mind_control_token
                value = 1
            }
        }
    }
}
token_spell_effect__mind_control = {
    area = {
        apply_modifier_spell_province_effect = {
            MODIFIER = mind_control
        }
        
        change_religion = FROM
    }
    
    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_mind_control_token
                value = 1
            }   
        }
    }
}

# Soothe Mind
scaled_spell_effect__soothe_mind = {
    every_neighbor_country = {
        add_opinion = {
            who = ROOT
            modifier = soothe_mind_opinion_mod
        }
    }
}

# Highfather's Will
scaled_spell_effect__highfathers_will = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_HIGHFATHERS_WILL_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_highfathers_will_token
                value = 5
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_HIGHFATHERS_WILL_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_highfathers_will_token
                value = 4
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_HIGHFATHERS_WILL_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_highfathers_will_token
                value = 4
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_HIGHFATHERS_WILL_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_highfathers_will_token
                value = 3
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_HIGHFATHERS_WILL_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_highfathers_will_token
                value = 3
            }
        }
    }
}
token_spell_effect__highfathers_will = {
    change_controller = FROM

    apply_modifier_spell_province_effect = {
        MODIFIER = highfathers_will
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_highfathers_will_token
                value = 1
            }   
        }
    }
}

# Order Above All
scaled_spell_effect__order_above_all = {
    custom_tooltip = ORDER_ABOVE_ALL_EFFECT_TT
    
    hidden_effect = {
        every_owned_province = {
            limit = {
                NOT = { is_core = ROOT }
            }
            
            add_core = ROOT
        }
    }
}

# Blessing of the Titans
scaled_spell_effect__blessing_of_the_titans = {
    custom_tooltip = RULER_MAY_BECOME_IMMORTAL_TT
}

blessing_of_the_titans_effect = {
    random_list = {
        10 = { 
            country_event = { id = wwu_spell_titanic.1 }
        }
        90 = { }
    }
}

# Runic Empowerment
scaled_spell_effect__runic_empowerment = {
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        create_general = {
            tradition = 100
        }
    }
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        create_general = {
            tradition = 95
        }
    }
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        create_general = {
            tradition = 90
        }
    }
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        create_general = {
            tradition = 85
        }
    }
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        create_general = {
            tradition = 80
        }
    }
}

# Ice Barrage
scaled_spell_effect__ice_barrage = {
    custom_tooltip = ICE_BARRAGE_EFFECT_TT
    hidden_effect = {
        every_owned_province = {
            scaled_magic_modifier_country_province_effect = {
                MODIFIER = ice_barrage_prov
            }
        }
    }
}

# Waking Nightmare
scaled_spell_effect__waking_nightmare = {
    custom_tooltip = WAKING_NIGHTMARE_EFFECT
}

waking_nightmare_effect = {
    if = {
        limit = {
            FROM = {
                OR = {
                    has_country_modifier = waking_nightmare_poor
                    has_country_modifier = waking_nightmare_common
                    has_country_modifier = waking_nightmare_rare
                    has_country_modifier = waking_nightmare_epic
                    has_country_modifier = waking_nightmare_legendary
                }
            }
        }
        
        change_religion = nightmare
        
        if = {
            limit = {
                FROM = {
                    has_country_modifier = waking_nightmare_poor
                }
            }
            
            FROM = {
                add_manpower = 1
            }
        }
        if = {
            limit = {
                FROM = {
                    has_country_modifier = waking_nightmare_common
                }
            }
            
            FROM = {
                add_manpower = 2
            }
        }
        if = {
            limit = {
                FROM = {
                    has_country_modifier = waking_nightmare_rare
                }
            }
            
            FROM = {
                add_manpower = 3
            }
        }
        if = {
            limit = {
                FROM = {
                    has_country_modifier = waking_nightmare_epic
                }
            }
            
            FROM = {
                add_manpower = 4
            }
        }
        if = {
            limit = {
                FROM = {
                    has_country_modifier = waking_nightmare_legendary
                }
            }
            
            FROM = {
                add_manpower = 5
            }
        }
    }
}

# Beckon the Horrors
scaled_spell_effect__beckon_the_horrors = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_100_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 1.0 }
            }
            
            add_manpower = 1.0
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_95_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.95 }
            }
            
            add_manpower = 1.0
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_90_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.9 }
            }
            
            add_manpower = 1.0
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_85_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.85 }
            }
            
            add_manpower = 1.0
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = RESTORE_MANPOWER_TO_80_PERCENT_TT
        while = {
            limit = {
                NOT = { manpower_percentage = 0.8 }
            }
            
            add_manpower = 1.0
        }
    }
}

# Nightmare Rift
scaled_spell_effect__nightmare_rift = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_NIGHTMARE_RIFT_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_nightmare_rift_token
                value = 5
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_NIGHTMARE_RIFT_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_nightmare_rift_token
                value = 4
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_NIGHTMARE_RIFT_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_nightmare_rift_token
                value = 4
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_NIGHTMARE_RIFT_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_nightmare_rift_token
                value = 3
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_NIGHTMARE_RIFT_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_nightmare_rift_token
                value = 3
            }
        }
    }
}
token_spell_effect__nightmare_rift = {
    change_controller = FROM
    
    apply_modifier_spell_province_effect = {
        MODIFIER = nightmare_rift
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_nightmare_rift_token
                value = 1
            }   
        }
    }
}

# Enrichment
scaled_spell_effect__enrichment = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_ENRICHMENT_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_enrichment_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_ENRICHMENT_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_enrichment_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_ENRICHMENT_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_enrichment_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_ENRICHMENT_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_enrichment_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_ENRICHMENT_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_enrichment_token
                value = 1
            }
        }
    }
}
token_spell_effect__enrichment = {
    if = {
        limit = {
            trade_goods = resource_common_ores
        }
        
        change_trade_goods = resource_rare_ores
    }
    
    if = {
        limit = {
            trade_goods = resource_common_metals
        }
        
        change_trade_goods = resource_rare_metals
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_enrichment_token
                value = 1
            }   
        }
    }
}

# Purged by Fire
scaled_spell_effect__purged_by_fire = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_PURGED_BY_FIRE_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_purged_by_fire_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_PURGED_BY_FIRE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_purged_by_fire_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_PURGED_BY_FIRE_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_purged_by_fire_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_PURGED_BY_FIRE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_purged_by_fire_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_PURGED_BY_FIRE_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_purged_by_fire_token
                value = 1
            }
        }
    }
}
token_spell_effect__purged_by_fire = {
    change_religion = FROM
    add_core = FROM

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_purged_by_fire_token
                value = 1
            }   
        }
    }
}

# Touch of Purification
scaled_spell_effect__touch_of_purification = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_TOUCH_OF_PURIFICATION_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_touch_of_purification_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_TOUCH_OF_PURIFICATION_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_touch_of_purification_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_TOUCH_OF_PURIFICATION_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_touch_of_purification_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_TOUCH_OF_PURIFICATION_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_touch_of_purification_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_TOUCH_OF_PURIFICATION_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_touch_of_purification_token
                value = 1
            }
        }
    }
}
token_spell_effect__touch_of_purification = {
    area = {
        change_religion = FROM
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_touch_of_purification_token
                value = 1
            }   
        }
    }
}

# Winds of Change
scaled_spell_effect__winds_of_change = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_stability = 3
        
        # Rebels
        reduce_rebel_faction_size = { TYPE = anti_tax_rebels SIZE = -80 }
        reduce_rebel_faction_size = { TYPE = nationalist_rebels SIZE = -80 }
        reduce_rebel_faction_size = { TYPE = noble_rebels SIZE = -80 }
        reduce_rebel_faction_size = { TYPE = pretender_rebels SIZE = -80 }
        reduce_rebel_faction_size = { TYPE = tribal_rebels SIZE = -80 }
        reduce_rebel_faction_size = { TYPE = heretic_rebels SIZE = -80 }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_stability = 2
        
        # Rebels
        reduce_rebel_faction_size = { TYPE = anti_tax_rebels SIZE = -60 }
        reduce_rebel_faction_size = { TYPE = nationalist_rebels SIZE = -60 }
        reduce_rebel_faction_size = { TYPE = noble_rebels SIZE = -60 }
        reduce_rebel_faction_size = { TYPE = pretender_rebels SIZE = -60 }
        reduce_rebel_faction_size = { TYPE = tribal_rebels SIZE = -60 }
        reduce_rebel_faction_size = { TYPE = heretic_rebels SIZE = -60 }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_stability = 2
        
        # Rebels
        reduce_rebel_faction_size = { TYPE = anti_tax_rebels SIZE = -40 }
        reduce_rebel_faction_size = { TYPE = nationalist_rebels SIZE = -40 }
        reduce_rebel_faction_size = { TYPE = noble_rebels SIZE = -40 }
        reduce_rebel_faction_size = { TYPE = pretender_rebels SIZE = -40 }
        reduce_rebel_faction_size = { TYPE = tribal_rebels SIZE = -40 }
        reduce_rebel_faction_size = { TYPE = heretic_rebels SIZE = -40 }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_stability = 1
        
        # Rebels
        reduce_rebel_faction_size = { TYPE = anti_tax_rebels SIZE = -30 }
        reduce_rebel_faction_size = { TYPE = nationalist_rebels SIZE = -30 }
        reduce_rebel_faction_size = { TYPE = noble_rebels SIZE = -30 }
        reduce_rebel_faction_size = { TYPE = pretender_rebels SIZE = -30 }
        reduce_rebel_faction_size = { TYPE = tribal_rebels SIZE = -30 }
        reduce_rebel_faction_size = { TYPE = heretic_rebels SIZE = -30 }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_stability = 1
        
        # Rebels
        reduce_rebel_faction_size = { TYPE = anti_tax_rebels SIZE = -20 }
        reduce_rebel_faction_size = { TYPE = nationalist_rebels SIZE = -20 }
        reduce_rebel_faction_size = { TYPE = noble_rebels SIZE = -20 }
        reduce_rebel_faction_size = { TYPE = pretender_rebels SIZE = -20 }
        reduce_rebel_faction_size = { TYPE = tribal_rebels SIZE = -20 }
        reduce_rebel_faction_size = { TYPE = heretic_rebels SIZE = -20 }
    }
}

reduce_rebel_faction_size = {
    if = {
        limit = {
            any_owned_province = { has_rebel_faction = $TYPE$ }
        }
        add_rebel_progress = {
            rebel_type = $TYPE$
            value = $SIZE$
        }
    }
}

# Tornado
scaled_spell_effect__tornado = {
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        custom_tooltip = GAIN_TORNADO_TOKEN_TT_3
        hidden_effect = {
            change_variable = {
                which = spell_tornado_token
                value = 3
            }
        }
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        custom_tooltip = GAIN_TORNADO_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_tornado_token
                value = 2
            }
        }
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        custom_tooltip = GAIN_TORNADO_TOKEN_TT_2
        hidden_effect = {
            change_variable = {
                which = spell_tornado_token
                value = 2
            }
        }
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        custom_tooltip = GAIN_TORNADO_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_tornado_token
                value = 1
            }
        }
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        custom_tooltip = GAIN_TORNADO_TOKEN_TT_1
        hidden_effect = {
            change_variable = {
                which = spell_tornado_token
                value = 1
            }
        }
    }
}
token_spell_effect__tornado = {
    apply_modifier_spell_province_effect = {
        MODIFIER = tornado
    }

    hidden_effect = {
        FROM = {
            subtract_variable = {
                which = spell_tornado_token
                value = 1
            }   
        }
    }
}

# Chains of Domination
scaled_spell_effect__chains_of_domination = {
    custom_tooltip = CHAINS_OF_DOMINATION_EFFECT_TT
    
    hidden_effect = {
        every_owned_province = {
            scaled_magic_modifier_country_province_effect = {
                MODIFIER = chains_of_domination_prov
            }
        }
    }
}

# Soul Sacrifice
scaled_spell_effect__soul_sacrifice = {
    kill_advisor = random
    
    # Legendary
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        add_adm_power = 250
        add_dip_power = 250
        add_mil_power = 250
    }
    # Epic
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        add_adm_power = 200
        add_dip_power = 200
        add_mil_power = 200
    }
    # Rare
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        add_adm_power = 150
        add_dip_power = 150
        add_mil_power = 150
    }
    # Common
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        add_adm_power = 100
        add_dip_power = 100
        add_mil_power = 100
    }
    # Poor
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        add_adm_power = 50
        add_dip_power = 50
        add_mil_power = 50
    }
}

# Ascension
scaled_spell_effect__ascension = {
    if = {
        limit = {
            has_legendary_finesse = yes
        }
        
        create_general = {
            tradition = 100
        }
    }
    else_if = {
        limit = {
            has_epic_finesse = yes
        }
        
        create_general = {
            tradition = 95
        }
    }
    else_if = {
        limit = {
            has_rare_finesse = yes
        }
        
        create_general = {
            tradition = 90
        }
    }
    else_if = {
        limit = {
            has_common_finesse = yes
        }
        
        create_general = {
            tradition = 85
        }
    }
    else_if = {
        limit = {
            has_poor_finesse = yes
        }
        
        create_general = {
            tradition = 80
        }
    }
}

# Burden of Sin
scaled_spell_effect__burden_of_sin = {  
    custom_tooltip = BURDEN_OF_SIN_EFFECT_TT
    
    hidden_effect = {
        every_owned_province = {
            province_event = { id = wwu_spell_soul.1 }
        }
    }
}