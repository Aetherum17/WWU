namespace = wwu_zandalar_pandaria_invasion

# War Preparations
country_event = {
	id = wwu_zandalar_pandaria_invasion.1
	title = wwu_zandalar_pandaria_invasion.1.title
	desc = wwu_zandalar_pandaria_invasion.1.desc
	picture = ZANDALAR_12_eventPicture
    
	is_triggered_only = yes
    
    # Resources for expeditions to Lei Shen's tomb
	option = {
		name = wwu_zandalar_pandaria_invasion.1.option.a
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_1
                        value = 4
                    }
                }
                adm_power = 25
                dip_power = 25
                mil_power = 25
            }
            
			custom_tooltip = zandalar_mogu_war_prep_1_a

			hidden_effect = {
                add_adm_power = -25
                add_dip_power = -25
                add_mil_power = -25
                
                change_variable = {
                    which = zandalar_mogu_war_prep_1
                    value = 1
                }
                
                country_event = { id = wwu_zandalar_pandaria_invasion.100 }
            }
        }
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_1
                        value = 4
                    }
			    }
                NOT = {
                    adm_power = 25
                    dip_power = 25
                    mil_power = 25
                }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_1_b
			clr_country_flag = mogu_prepare_to_war_already_open
        }
        
		if = {
            limit = {
                check_variable = {
                    which = zandalar_mogu_war_prep_1
                    value = 4
                }
            }
            
            custom_tooltip = zandalar_mogu_war_prep_1_c
            clr_country_flag = mogu_prepare_to_war_already_open
		}
    }
	
    # Sending troops to garrisons
	option = {
		name = wwu_zandalar_pandaria_invasion.1.option.b
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_2
                        value = 10
                    }
                }
                
                # Warport Rastari
				2611 = {
                    infantry_in_province = 10
				}
            }
            
			custom_tooltip = zandalar_mogu_war_prep_2_a

			hidden_effect = {
                # Warport Rastari
				2611 = {
                    kill_units = {
                        who = ROOT
                        type = infantry	
                        amount = 10
                    }
                }
                
                country_event = { id = wwu_zandalar_pandaria_invasion.100 }
                
                change_variable = {
                    which = zandalar_mogu_war_prep_2
                    value = 1
                }
            }
        }
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_2
                        value = 10
                    }
                }
				NOT = {
                    # Warport Rastari
                    2611 = {
                        infantry_in_province = 10
                    }
                }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_2_b
            clr_country_flag = mogu_prepare_to_war_already_open
        }
        
		if = {
            limit = {
                check_variable = {
                    which = zandalar_mogu_war_prep_2
                    value = 10
                }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_2_c
            clr_country_flag = mogu_prepare_to_war_already_open
		}
    }

    # Sending reservists to garrisons
	option = {
		name = wwu_zandalar_pandaria_invasion.1.option.c
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_3
                        value = 10
                    }
                }
                manpower = 10
            }
            
			custom_tooltip = zandalar_mogu_war_prep_3_a

			hidden_effect = {
                add_manpower = -10
                
                change_variable = {
                    which = zandalar_mogu_war_prep_3
                    value = 1
                }
                
                country_event = { id = wwu_zandalar_pandaria_invasion.100 }
            }
        }
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_3
                        value = 10
                    }
                }
				NOT = { manpower = 10 }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_3_b
            clr_country_flag = mogu_prepare_to_war_already_open
        }
        
		if = {
            limit = {
                check_variable = {
                    which = zandalar_mogu_war_prep_3
                    value = 10
                }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_3_c
            clr_country_flag = mogu_prepare_to_war_already_open
		}
    }
	
    # Accumulation of funds
	option = {
		name = wwu_zandalar_pandaria_invasion.1.option.d
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_4
                        value = 10
                    }
                }
                treasury = 200
            }
            
			custom_tooltip = zandalar_mogu_war_prep_4_a

			hidden_effect = {
                add_treasury = -200
                
                change_variable = {
                    which = zandalar_mogu_war_prep_4
                    value = 1
                }
                
                country_event = { id = wwu_zandalar_pandaria_invasion.100 }
            }
        }
        
		if = {
            limit = {
                NOT = {
                    check_variable = {
                        which = zandalar_mogu_war_prep_4
                        value = 10
                    }
                }
				NOT = { treasury = 200 }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_4_b
            clr_country_flag = mogu_prepare_to_war_already_open
        }
        
		if = {
            limit = {
                check_variable = {
                    which = zandalar_mogu_war_prep_4
                    value = 10
                }
            }
            
			custom_tooltip = zandalar_mogu_war_prep_4_c
            clr_country_flag = mogu_prepare_to_war_already_open
		}
    }
	
    # Back
	option = {
		name = wwu_zandalar_pandaria_invasion.1.option.x
        
        clr_country_flag = mogu_prepare_to_war_already_open
	}
}
			
# Pandaria's Great War            
country_event = {
	id = wwu_zandalar_pandaria_invasion.10
	title = wwu_zandalar_pandaria_invasion.10.title
	desc = wwu_zandalar_pandaria_invasion.10.desc
	picture = ZANDALAR_12_eventPicture
    
	is_triggered_only = yes
    
	option = {
		name = wwu_zandalar_pandaria_invasion.10.option.a
        
		custom_tooltip = zandalar_mogu_war_start_tt
        
		hidden_effect = {
            # Zouchin Village
            1904 = {
                cede_province = ZFC
                add_core = ZFC
            }
            
			create_subject = {              
				subject_type = vassal      
				subject = ZFC       
			}
            
            add_country_modifier = { 
                name = thunderking_lookingfor_cooldown
                duration = 700
                hidden = yes
            }
            
        }
    }
    
    after = {
        ZFC = {
            country_event = { id = wwu_zandalar_pandaria_invasion.11 days = 1 }
        }
        
        country_event = { id = wwu_zandalar_pandaria_invasion.12 days = 1 }
    }
}          
		
# Zul's Expedition
country_event = {
	id = wwu_zandalar_pandaria_invasion.11
    title = wwu_zandalar_pandaria_invasion.11.title
	desc = wwu_zandalar_pandaria_invasion.11.desc
	picture = ZANDALAR_12_eventPicture
    
	is_triggered_only = yes
    
    trigger = {
        tag = ZFC
    }
	
	mean_time_to_happen = {
		days = 1
	}
        
    option = {
        name = wwu_zandalar_pandaria_invasion.11.option.a
        
        capital_scope = {
            spawn_infantry = {
                AMOUNT = 80
                TAG = ZFC
            }
            spawn_cavalry = {
                AMOUNT = 10
                TAG = ZFC
            }
            spawn_artillery = {
                AMOUNT = 10
                TAG = ZFC
            }
        }
    
        define_general = {
            shock = 6
            fire = 5
            manuever = 4
            siege = 5
            name = "Vilnak'dor"
        }
        
        # This prevents the normal succession event from occuring
        hidden_effect = {
            set_country_flag = skip_next_succession_event
        }
        
        define_ruler = {
            name = "Prophet Zul"
            dynasty = "Zandalar"
            adm = 6
            dip = 6
            mil = 6
            age = 50
            claim = 95
        }
        
        add_treasury = 5000
        add_manpower = 100
        
        add_country_modifier = {
            name = zandalar_invasion_force_upgrade
            duration = 7000
            hidden = yes
        }
        discover_pandaria = yes
        discover_zandalar = yes
        discover_paradise_isles = yes
        discover_south_seas = yes
    }
}

# War in Pandaria
country_event = {
	id = wwu_zandalar_pandaria_invasion.12
    title = wwu_zandalar_pandaria_invasion.12.title
	desc = wwu_zandalar_pandaria_invasion.12.desc
	picture = ZANDALAR_12_eventPicture
    
	is_triggered_only = yes
	
	mean_time_to_happen = {
		days = 1
	}
    immediate = {
		hidden_effect = {

			random_country = {
				limit = {
					OR = {
					culture_group = culture_group_jinyu
                    culture_group = culture_group_hozen
                    culture_group = culture_group_pandaren
					}
					capital_scope = { 
                        superregion = pandaria_superregion
                    }
					NOT = { tag = ROOT }
				}
				save_global_event_target_as = panda_target
			}
			}
		if = {
			limit = {
				exists = event_target:panda_target

			}

        declare_war_with_cb = {
            who = event_target:panda_target
            casus_belli = cb_zandalar_war_against_pandaria
        }
		}
    }
    option = {
        name = wwu_zandalar_pandaria_invasion.12.option.a
        
        set_country_flag = zandalar_war_against_pandaria_started
            

        
        every_country = {
            limit = {
                OR = {
                    culture_group = culture_group_jinyu
                    culture_group = culture_group_hozen
                    culture_group = culture_group_pandaren
                }
                    capital_scope = { 
                        superregion = pandaria_superregion
                    }
            }
            join_all_defensive_wars_of = event_target:panda_target
        }
        
    }
	after = {
		event_target:panda_target = {
			set_country_flag = zandalar_is_pandaria_defender
		}
		country_event = { id = wwu_zandalar_pandaria_invasion.13 days = 3 }
	}
}
	
country_event = {
    id = wwu_zandalar_pandaria_invasion.13
    title = wwu_zandalar_pandaria_invasion.13.title
    desc = wwu_zandalar_pandaria_invasion.13.desc
    picture = ZANDALAR_12_eventPicture
	hidden = yes
    is_triggered_only = yes

		option = {
		name = "wwu_zandalar_pandaria_invasion.23.option.a"
			ROOT = {
				every_country = {
					limit = {
						is_in_war = {
							attackers = ROOT
							defenders = THIS
							casus_belli = cb_zandalar_war_against_pandaria
						}
					}
					set_country_flag = zandalar_defender_for_resolution
				}
			}
		}
	}
    
#Pandaria participation
country_event = {
    id = wwu_zandalar_pandaria_invasion.20
    title = wwu_zandalar_pandaria_invasion.20.title
    desc = wwu_zandalar_pandaria_invasion.20.desc
    picture = ZANDALAR_12_eventPicture

    is_triggered_only = yes
		trigger = {
			tag = A78
			has_country_flag = zandalar_war_against_pandaria_started
			is_at_war = no
			OR = {
				AND = {
					has_country_flag = zandalar_war_against_pandaria_win
					any_country = {
						has_country_flag = zandalar_defender_for_resolution
					}
				}
				AND = {
				has_country_flag = zandalar_war_against_pandaria_lost
				NOT = { has_country_flag = zandalar_war_against_pandaria_lost_end }
				}
			}
		}


	immediate = {
		random_country = {
			limit = {
				has_country_flag = zandalar_defender_for_resolution
			}
			save_event_target_as = current_defender
		}
	}

	option = {
	trigger = {
	has_country_flag = zandalar_war_against_pandaria_win
	}
		name = "wwu_zandalar_pandaria_invasion.20.option.a"
		ai_chance = { factor = 10 }
		
		if = {
		limit = {
		NOT = { has_country_flag = zandalar_enterprise_zul }
		}
		create_subject = {  
			subject_type = commercial_enterprise
			subject = ZFC
		}
		set_country_flag = zandalar_enterprise_zul
		ZFC = {
		override_country_name = zandalar_enterprise
		remove_country_modifier = zandalar_invasion_force_upgrade
		change_government = republic
		add_republican_tradition = 100
		set_government_rank = 2
		}
		custom_tooltip = zandalari_zfc_enterprise_claim
		hidden_effect = {
		every_province = {
		limit = {
		superregion = pandaria_superregion
		NOT = {
			owned_by = ROOT
		}
		}
		add_permanent_claim = ZFC
		}
		}
		}
		
		
		event_target:current_defender = {
		clr_country_flag = zandalar_defender_for_resolution
		}
		
		ZFC = {
		inherit = event_target:current_defender
		}

		if = {
		limit = {
		event_target:current_defender = {
		NOT = { total_development = 33 }
		}
		}
		custom_tooltip = zandalari_zfc_8_2
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 33
		NOT = { total_development = 66 }
		}
		}
		custom_tooltip = zandalari_zfc_16_4
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 66
		NOT = { total_development = 100 }
		}
		}
		custom_tooltip = zandalari_zfc_24_6
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 100
		NOT = { total_development = 133 }
		}
		}
		custom_tooltip = zandalari_zfc_32_8
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 133
		NOT = { total_development = 166 }
		}
		}
		custom_tooltip = zandalari_zfc_40_10
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 166
		NOT = { total_development = 200 }
		}
		}
		custom_tooltip = zandalari_zfc_48_12
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 200
		NOT = { total_development = 233 }
		}
		}
		custom_tooltip = zandalari_zfc_56_14
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 233
		NOT = { total_development = 266 }
		}
		}
		custom_tooltip = zandalari_zfc_64_16
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 266
		NOT = { total_development = 300 }
		}
		}
		custom_tooltip = zandalari_zfc_72_18
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 300
		}
		}
		custom_tooltip = zandalari_zfc_80_20
		}



		hidden_effect = {
		ZFC = {
		every_owned_province = {
		kill_units = {
			who = ZFC   # optional, only affect <scope>'s units. Scopes enemy, owner and controller work here.
			amount = 100
		}
		}
		}
		# AE lokalna
		if = {
		limit = {
		event_target:current_defender = {
		NOT = { total_development = 33 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 8 
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 2
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 33
		NOT = { total_development = 66 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 16 
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 4
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 66
		NOT = { total_development = 100 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 24 
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 6
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 100
		NOT = { total_development = 133 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 32
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 8
			}
		}
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 133
		NOT = { total_development = 166 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 40
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 10
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 166
		NOT = { total_development = 200 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 48
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 12
			}
		}
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 200
		NOT = { total_development = 233 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 54
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 14
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 233
		NOT = { total_development = 266 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 62
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 16
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 266
		NOT = { total_development = 300 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 70
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 18
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 300
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 78
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 20
			}
		}
		}
		
		}

		# Zapętl event, jeśli są kolejni
		if = {
			limit = {
				any_country = { has_country_flag = zandalar_defender_for_resolution }
			}
			country_event = { id = wwu_zandalar_pandaria_invasion.20 }
		}
	}

	option = {
	trigger = {
	has_country_flag = zandalar_war_against_pandaria_win
	}
		name = "wwu_zandalar_pandaria_invasion.20.option.b"
		ai_chance = { factor = 5 }
		
		if = {
		limit = {
		NOT = { has_country_flag = zandalar_enterprise_zul }
		}
		create_subject = {  
			subject_type = commercial_enterprise
			subject = ZFC
		}
		set_country_flag = zandalar_enterprise_zul
		ZFC = {
		override_country_name = zandalar_enterprise
		remove_country_modifier = zandalar_invasion_force_upgrade
		change_government = republic
		add_republican_tradition = 100
		set_government_rank = 2
		}
		custom_tooltip = zandalari_zfc_enterprise_claim
		hidden_effect = {
		every_province = {
		limit = {
		superregion = pandaria_superregion
		NOT = {
			owned_by = ROOT
		}
		}
		add_permanent_claim = ZFC
		}
		}
		}
		
		event_target:current_defender = {
		clr_country_flag = zandalar_defender_for_resolution
		}
		
		ZFC = {
			create_subject = {              
				subject_type = vassal      
				subject = event_target:current_defender          
			}
		}
		
		if = {
		limit = {
		event_target:current_defender = {
		NOT = { total_development = 33 }
		}
		}
		custom_tooltip = zandalari_zfc_5_1
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 33
		NOT = { total_development = 66 }
		}
		}
		custom_tooltip = zandalari_zfc_10_2
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 66
		NOT = { total_development = 100 }
		}
		}
		custom_tooltip = zandalari_zfc_15_3
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 100
		NOT = { total_development = 133 }
		}
		}
		custom_tooltip = zandalari_zfc_20_4
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 133
		NOT = { total_development = 166 }
		}
		}
		custom_tooltip = zandalari_zfc_25_5
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 166
		NOT = { total_development = 200 }
		}
		}
		custom_tooltip = zandalari_zfc_30_6
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 200
		NOT = { total_development = 233 }
		}
		}
		custom_tooltip = zandalari_zfc_35_7
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 233
		NOT = { total_development = 266 }
		}
		}
		custom_tooltip = zandalari_zfc_40_8
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 266
		NOT = { total_development = 300 }
		}
		}
		custom_tooltip = zandalari_zfc_45_9
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 300
		}
		}
		custom_tooltip = zandalari_zfc_50_10
		}
		
		hidden_effect = {
		every_country = {
		white_peace = event_target:current_defender
		}
		}
		

		
		hidden_effect = {
		ZFC = {
		every_owned_province = {
		kill_units = {
			who = ZFC   # optional, only affect <scope>'s units. Scopes enemy, owner and controller work here.
			amount = 100
		}
		}
		}
		if = {
		limit = {
		event_target:current_defender = {
		NOT = { total_development = 33 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 5 
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 1
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 33
		NOT = { total_development = 66 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 10
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 2
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 66
		NOT = { total_development = 100 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 15
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 3
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 100
		NOT = { total_development = 133 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 20
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 4
			}
		}
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 133
		NOT = { total_development = 166 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 25
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 5
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 166
		NOT = { total_development = 200 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 30
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 6
			}
		}
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 200
		NOT = { total_development = 233 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 35
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 7
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 233
		NOT = { total_development = 266 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 40
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 8
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 266
		NOT = { total_development = 300 }
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 45
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 9
			}
		}
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 300
		}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				capital_scope = {
					superregion = pandaria_superregion
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 50
			}
		}
		every_country = {
			limit = {
				NOT = { is_subject = yes }
				NOT = { alliance_with = ROOT }
				NOT = {
					capital_scope = {
						superregion = pandaria_superregion
					}
				}
			}
			add_aggressive_expansion = {
				who = ROOT
				value = 10
			}
		}
		}
		}

		if = {
			limit = {
				any_country = { has_country_flag = zandalar_defender_for_resolution }
			}
			country_event = { id = wwu_zandalar_pandaria_invasion.20 }
		}
	}

	option = {
	trigger = {
	has_country_flag = zandalar_war_against_pandaria_win
	}
		name = "wwu_zandalar_pandaria_invasion.20.option.c"
		
		if = {
		limit = {
		NOT = { has_country_flag = zandalar_enterprise_zul }
		}
		create_subject = {  
			subject_type = commercial_enterprise
			subject = ZFC
		}
		set_country_flag = zandalar_enterprise_zul
		ZFC = {
		override_country_name = zandalar_enterprise
		remove_country_modifier = zandalar_invasion_force_upgrade
		change_government = republic
		add_republican_tradition = 100
		set_government_rank = 2
		}
		custom_tooltip = zandalari_zfc_enterprise_claim
		hidden_effect = {
		every_province = {
		limit = {
		superregion = pandaria_superregion
		NOT = {
			owned_by = ROOT
		}
		}
		add_permanent_claim = ZFC
		}
		}
		}
		
		ai_chance = { factor = 3 }
		
		hidden_effect = {
		ZFC = {
		every_owned_province = {
		kill_units = {
			who = ZFC   # optional, only affect <scope>'s units. Scopes enemy, owner and controller work here.
			amount = 100
		}
		}
		}
		}
		if = {
		limit = {
		event_target:current_defender = {
		NOT = { total_development = 33 }
		}
		}
		event_target:current_defender = {
			add_treasury = -50 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 50
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 33
		NOT = { total_development = 66 }
		}
		}
		event_target:current_defender = {
			add_treasury = -100 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 100
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 66
		NOT = { total_development = 100 }
		}
		}
		event_target:current_defender = {
			add_treasury = -150 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 150
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 100
		NOT = { total_development = 133 }
		}
		}
		event_target:current_defender = {
			add_treasury = -200 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 200
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 133
		NOT = { total_development = 166 }
		}
		}
		event_target:current_defender = {
			add_treasury = -250 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 250
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 166
		NOT = { total_development = 200 }
		}
		}
		event_target:current_defender = {
			add_treasury = -300 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 300
		}

		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 200
		NOT = { total_development = 233 }
		}
		}
		event_target:current_defender = {
			add_treasury = -350 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 350
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 233
		NOT = { total_development = 266 }
		}
		}
		event_target:current_defender = {
			add_treasury = -400 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 400
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 266
		NOT = { total_development = 300 }
		}
		}
		event_target:current_defender = {
			add_treasury = -450 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 450
		}
		
		else_if = {
		limit = {
		event_target:current_defender = {
		total_development = 300
		}
		}
		event_target:current_defender = {
			add_treasury = -500 # 
			clr_country_flag = zandalar_defender_for_resolution
		}
		add_treasury = 500
		}

		if = {
			limit = {
				any_country = { has_country_flag = zandalar_defender_for_resolution }
			}
			country_event = { id = wwu_zandalar_pandaria_invasion.20 }
		}
	}

    option = {
	trigger = {
	has_country_flag = zandalar_war_against_pandaria_lost
	}
        name = "wwu_zandalar_pandaria_invasion.20.option.d"
            add_stability = -3
            increase_zul_power_by_10 = yes
            increase_zul_influence_by_10 = yes
			ZFC = {
			remove_country_modifier = zandalar_invasion_force_upgrade
			}
			set_country_flag = zandalar_war_against_pandaria_lost_end
    }
	
	after = {
		if = {
			limit = {
				any_country = { has_country_flag = zandalar_defender_for_resolution }
			}
			country_event = { id = wwu_zandalar_pandaria_invasion.101 }
		}
	}
}



# Lei Shen's Body
country_event = {
	id = wwu_zandalar_pandaria_invasion.30
    title = wwu_zandalar_pandaria_invasion.30.title
	desc = wwu_zandalar_pandaria_invasion.30.desc
	picture = ZANDALAR_11_eventPicture
    
	is_triggered_only = yes
    
    trigger = {
        NOT = { has_global_flag = lei_shen_body_event }
        tag = A78 # Zandalar
		has_country_flag = zandalar_war_against_pandaria_started
		NOT = { has_country_modifier = thunderking_lookingfor_cooldown }
    }
    
    mean_time_to_happen = {
		days = 1
	}
    
    immediate = {
        hidden_effect = {
            set_global_flag = lei_shen_body_event 
        }
    }
    
    option = {
        name = wwu_zandalar_pandaria_invasion.30.option.a
        
        custom_tooltip = zandalari_event_thunderking_a
        set_country_flag = zandalari_found_thunderking
        
         if = {
            limit = {
                exists = P92 # Shan'ze
            }
            
		    reverse_add_opinion = {
                who = P92 # Shan'ze
                modifier = mogu_zandalar_found_thunder_king_a
            }
        }
    }
	
    option = {
        name = wwu_zandalar_pandaria_invasion.30.option.b
        
        custom_tooltip = zandalari_ruler_immortal_tt
        hidden_effect = {
            set_ruler_flag = is_immortal
        if = {
            limit = {
                has_ruler_flag = powerful_zandalar_loa_blessing
            }
            
		    clr_ruler_flag = powerful_zandalar_loa_blessing
		remove_country_modifier = powerful_zandalar_loa_blessing
		}
        if = {
            limit = {
                has_ruler_flag = great_zandalar_loa_blessing
            }
            
		    clr_ruler_flag = great_zandalar_loa_blessing
		remove_country_modifier = great_zandalar_loa_blessing
		}
        if = {
            limit = {
                has_ruler_flag = zandalar_loa_blessing
            }
            
		    clr_ruler_flag = zandalar_loa_blessing
		remove_country_modifier = zandalar_loa_blessing
		}
        }
        
        if = {
            limit = {
                exists = P92 # Shan'ze
            }
            
		    reverse_add_opinion = {
                who = P92 # Shan'ze
                modifier = mogu_zandalar_found_thunder_king_b
            }
        }
				
        every_country = {
			limit = {
                culture_group = culture_group_mogu
            }
            
			join_all_defensive_wars_of = event_target:panda_target
			
        }
		
		
    }
	after = {
	country_event = { id = wwu_zandalar_pandaria_invasion.13 days = 3 }
	}
	
}

# Rise of the Thunder King
country_event = {
	id = wwu_zandalar_pandaria_invasion.31
    title = wwu_zandalar_pandaria_invasion.31.title
	desc = wwu_zandalar_pandaria_invasion.31.desc
	picture = ZANDALAR_11_eventPicture
    
	is_triggered_only = yes
	
    major = yes
	major_trigger = {
		capital_scope = {
            OR = {
                superregion = pandaria_superregion
                superregion = zandalar_superregion
            }
        }
	}
    
    option = {
        name = wwu_zandalar_pandaria_invasion.31.option.a
        
        # This prevents the normal succession event from occuring
        hidden_effect = {
            set_country_flag = skip_next_succession_event
        }
        
        define_ruler = {
            name = "Lei Shen"
            dynasty = "Thunder King"
            adm = 7
            dip = 7
            mil = 7
            age = 655
            claim = 100
        }
        
        set_ruler_flag = is_immortal
        
        add_ruler_modifier = { 
            name = mogu_thunder_king_rise
            duration = -1  
        }
            
        custom_tooltip = zandalari_event_thunderking_rise_army
        
        hidden_effect = {
            capital_scope = {
                spawn_infantry = {
                    AMOUNT = 50
                    TAG = ROOT
                }
            }
        }
    }
}
	
# Menu Loop
country_event = {
	id = wwu_zandalar_pandaria_invasion.100
	title = wwu_zandalar_pandaria_invasion.100.title
	desc = wwu_zandalar_pandaria_invasion.100.desc
	picture = ZANDALAR_12_eventPicture
    
    hidden = yes
	is_triggered_only = yes
    
	option = {
		name = wwu_zandalar_pandaria_invasion.100.option.a
        
        country_event = { id = wwu_zandalar_pandaria_invasion.1 }
    }
}

country_event = {
	id = wwu_zandalar_pandaria_invasion.101
	title = wwu_zandalar_pandaria_invasion.101.title
	desc = wwu_zandalar_pandaria_invasion.101.desc
	picture = ZANDALAR_12_eventPicture
    
    hidden = yes
	is_triggered_only = yes
    
	option = {
		name = wwu_zandalar_pandaria_invasion.101.option.a
        
        country_event = { id = wwu_zandalar_pandaria_invasion.20 }
    }
}
