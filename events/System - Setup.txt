namespace = wwu_setup

#---------------------------------------
# World
#---------------------------------------
country_event = {
	id = wwu_setup.1
	title = wwu_setup.1.title
	desc = wwu_setup.1.desc
	picture = BESTIARY_eventPicture
	
    hidden = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_global_flag = completed_wwu_setup }
        ai = no
    }

    immediate = {
        set_global_flag = completed_wwu_setup
        
        # Set first player country as executor tag
        save_global_event_target_as = executor
        
        # World State
        #hre_inheritable = yes
        #set_papacy_active = no
        
        # Initializes variables which are used in on_actions
		init_variables = yes
		
		# Religious and Cultural Unity for ALL NATIONS on start and Core creation.
		# This will override history files in default setting. See script file to see how to avoid overriding.
		# init_full_unity = yes

        # Invention Timer
        set_global_flag = game_duration_timer
    
        # Names
        if = {
            limit = {
                NOT = { is_year = 592 }
            }
            DKS = {
                override_country_name = GRAND_HAMLET
            }
        }
    
        # Game flags
        #  Used to detect which bookmark the flag starts in, accounting for time adjustments
        
        # Rise of the Horde
        if = { 
            limit = {
                is_year = 546
            }
            set_global_flag = rise_of_the_horde
        }
        
        # The First War
        if = {
            limit = {
                is_year = 592
            }
            set_global_flag = the_first_war
            set_global_flag = dark_portal_opened_flag
            set_global_flag = dark_portal_built
            
            set_global_flag = alliance_exists
            set_global_flag = setup_the_alliance
            
            set_global_flag = old_horde_exists
            set_global_flag = setup_the_old_horde
            
            # Disable Old Horde country setup events
            set_global_flag = old_horde_country_setup
            
            3792 = {
                add_canal = gp_dark_portal_draenor
            }
            
            reveal_first_war_discovery = yes
        }

        # The Second War
        if = { 
            limit = {
                is_year = 598
            }
            set_global_flag = the_second_war
            set_global_flag = setup_outland
            
            # Disable Outland country setup events
            set_global_flag = outland_country_setup
            
            1586 = { add_canal = gp_dark_portal_outland }
            
            reveal_second_war_discovery = yes
        }
		
        # Beyond The Dark Portal
        if = { 
            limit = {
                is_year = 600
            }
            set_global_flag = beyond_the_dark_portal
			clr_global_flag = dark_portal_opened_flag
			set_global_flag = dark_portal_closed_firsttime
			set_global_flag = sonsoflothar
			set_global_flag = khadgar
            
            1586 = { remove_canal = gp_dark_portal_outland }
            
            reveal_all_discovery = yes
        }
		
		# Rise of the Lich King
		if = { 
            limit = {
                is_year = 605
            }
            set_global_flag = setup_outland
        }

        # The Third War
        if = { 
            limit = {
                is_year = 617
            }
            set_global_flag = the_third_war 
            set_global_flag = scourge_of_lordaeron_flag
			set_global_flag = scourge_invasion # Used for the secondary Scourge tree
            
			set_global_flag = setup_outland
        }

        # The Frozen Throne
        if = { 
            limit = {
                is_year = 618
            }
			set_global_flag = the_third_war 
            set_global_flag = scourge_of_lordaeron_flag
            set_global_flag = the_frozen_throne
            set_global_flag = archimonde_dead
			set_global_flag = eye_of_sargeras
			set_global_flag = sunfury_arrived
			set_global_flag = nerzhul_arrived
        }

        # The Rise of the Qiraji
        if = { 
            limit = {
                is_year = 622
            }
            set_global_flag = rise_of_the_qiraji
            set_global_flag = illidan_frozen_throne
            
            set_global_flag = horde_exists
            set_global_flag = setup_the_horde
            
            clr_global_flag = old_horde_exists
            clr_global_flag = setup_the_old_horde
            
            set_global_flag = northgate_rebellion_happened
        }

        # The Burning Crusade
        if = { 
            limit = {
                is_year = 625
            }
            set_global_flag = the_burning_crusade
        }

        # Wrath of the Lich King
        if = { 
            limit = {
                is_year = 626
            }
            set_global_flag = wrath_of_the_lich_king
        }

        # Cataclysm
        if = { 
            limit = {
                is_year = 631
            }
            set_global_flag = cataclysm
        }

        # Mists of Pandaria
        if = { 
            limit = {
                is_year = 632
            }
            set_global_flag = mists_of_pandaria
        }
        if = { 
            limit = {
                is_year = 700
            }
            set_global_flag = doomed_world
        }
        
        # Custom Pulses
        291 = {
            add_province_triggered_modifier = generic_daily_pulse
        }
    }

    option = {
		name = wwu_setup.1.option.a
    }  
}

#---------------------------------------
# Country
#---------------------------------------
country_event = {
	id = wwu_setup.2
	title = wwu_setup.2.title
	desc = wwu_setup.2.desc
	picture = BESTIARY_eventPicture
	
    is_triggered_only = yes
    hidden = yes

    trigger = {
        NOT = { has_country_flag = completed_country_wwu_setup }
    }
    
    immediate = {
        setup_world_discovery = yes
        
        set_country_flag = completed_country_wwu_setup
        
        # Building Management Settings
        set_country_flag = gold_buffer_limit_low
        set_country_flag = auto_build_target_all
        set_country_flag = auto_destroy_target_all
        
        # Archaeology
        set_variable = { which = artifact_catalogue_carved_figurine     value = 0 }
        set_variable = { which = artifact_catalogue_golden_tankard      value = 0 }
        set_variable = { which = artifact_catalogue_notched_sword       value = 0 }
        set_variable = { which = artifact_catalogue_music_box           value = 0 }
        set_variable = { which = artifact_catalogue_ancient_crown       value = 0 }
        set_variable = { which = artifact_catalogue_treasure_chest      value = 0 }
        
        # Starting Strength of Will
        if = {
            limit = {
                religion = arcane
            }
            
            add_patriarch_authority = 0.25
        }
        
        # Remove Orcish Horde cores after 600
        if = {
            limit = {
                is_year = 600
            }
            every_owned_province = {
                limit = {
                    is_core = U03
                }
                remove_core = U03
            }
        }
        
        every_owned_province = {
            limit = {
                culture_group = culture_group_scourge
                trade_goods = grain
            }
            change_trade_goods = crypts
        }
        
        every_owned_province = {
            limit = {
                culture_group = culture_group_undead
                trade_goods = grain
            }
            change_trade_goods = crypts
        }
        
        every_owned_province = {
            limit = {
                religion = fel
                trade_goods = arcane
            }
            change_trade_goods = fel
        }
        
        every_owned_province = {
            limit = {
                religion = cult_of_the_damned
                trade_goods = arcane
            }
            change_trade_goods = fel
        }
        
        every_owned_province = {
            limit = {
                NOT = { religion = fel }
                NOT = { religion = cult_of_the_damned }
                trade_goods = fel
            }
            change_trade_goods = arcane
        }
        
        if = {
            limit = {
                owns = 1671
            }
            add_country_modifier = {
                name = lord_of_outland
                duration = -1
            }
        }
        
        # Randomise the AI usage of the magic menu by staggering the cooldowns
        if = {
            limit = {
                ai = yes
            }
            
            random_list = {
                25 = {
                    add_country_modifier = {
                        name = ai_spell_cooldown
                        duration = 3650
                    }
                }
                25 = {
                    add_country_modifier = {
                        name = ai_spell_cooldown
                        duration = 7300
                    }
                }
                25 = {
                    add_country_modifier = {
                        name = ai_spell_cooldown
                        duration = 10950
                    }
                }
                25 = {
                    add_country_modifier = {
                        name = ai_spell_cooldown
                        duration = 1825
                    }
                }
            }
        }
        
        # Add starting classes for rulers that are predefined
        add_starting_class_for_ruler = yes
        
        # Remove starting ideagroups
        remove_starting_ideagroups = yes
    }
    
    option = {
		name = wwu_setup.2.option.a
    }  
}

