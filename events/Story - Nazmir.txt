namespace = wwu_nazmir

# An start event that appears to the player choosing one of the 3 countries
country_event = {
  id = wwu_nazmir.1
  title = wwu_nazmir.1.title
  desc = wwu_nazmir.1.desc
  picture = NAZMIR_1_eventPicture

  fire_only_once = yes
  is_triggered_only = yes

  trigger = {
    any_country = {
      NOT = {
        has_country_flag = nazmir_start_opened
      }
      NOT = {
        has_country_flag = first_blood_matron
      }
    }
    OR = {
      AND = {
        tag = NZM # Nazmani
        ai = no
        NTV = {
          ai = yes
        }
        AMK = {
          ai = yes
        }
      }
      AND = {
        tag = NZM # Nazmani
        ai = yes
        NTV = {
          ai = yes
        }
        AMK = {
          ai = yes
        }
      }

      AND = {
        tag = NZM # Nazmani
        ai = yes
        NTV = {
          ai = yes
        }
        AMK = {
          ai = no
        }
      }
      AND = {
        tag = NZM # Nazmani
        ai = yes
        NTV = {
          ai = no
        }
        AMK = {
          ai = yes
        }
      }
      AND = {
        tag = NZM # Nazmani
        ai = no
        NTV = {
          ai = yes
        }
        AMK = {
          ai = yes
        }
      }
      AND = {
        tag = NTV # Natha 'vor
        ai = no
        NZM = {
          ai = yes
        }
        AMK = {
          ai = yes
        }
      }
      AND = {
        tag = AMK # Nazmani
        ai = no
        NTV = {
          ai = yes
        }
        NZM = {
          ai = yes
        }
      }
    }
  }

  immediate = {
    hidden_effect = {
      NZM = {
        set_country_flag = nazmir_start_opened
        set_variable = {
          which = nazmir_blood
          value = 0
        }
      }
      NTV = {
        set_country_flag = nazmir_start_opened
        set_variable = {
          which = nazmir_blood
          value = 0
        }
      }
      AMK = {
        set_country_flag = nazmir_start_opened
        set_variable = {
          which = nazmir_blood
          value = 0
        }
      }
      NZM = {
        set_variable = {
          which = nazmir_small
          value = 0
        }
      }
      NTV = {
        set_variable = {
          which = nazmir_small
          value = 0
        }
      }
      AMK = {
        set_variable = {
          which = nazmir_small
          value = 0
        }
      }
      NZM = {
        set_variable = {
          which = nazmir_medium
          value = 0
        }
      }
      NTV = {
        set_variable = {
          which = nazmir_medium
          value = 0
        }
      }
      AMK = {
        set_variable = {
          which = nazmir_medium
          value = 0
        }
      }
      NZM = {
        set_variable = {
          which = nazmir_big
          value = 0
        }
      }
      NTV = {
        set_variable = {
          which = nazmir_big
          value = 0
        }
      }
      AMK = {
        set_variable = {
          which = nazmir_big
          value = 0
        }
      }
      NZM = {
        set_variable = {
          which = nazmir_curse
          value = 1
        }
      }
      NTV = {
        set_variable = {
          which = nazmir_curse
          value = 1
        }
      }
      AMK = {
        set_variable = {
          which = nazmir_curse
          value = 1
        }
      }
      if = {
        limit = {
          OR = {
            AND = {
              tag = NZM # Nazmani
              ai = no
              NTV = {
                ai = yes
              }
              AMK = {
                ai = yes
              }
            }
            AND = {
              tag = NZM # Nazmani
              ai = yes
              NTV = {
                ai = yes
              }
              AMK = {
                ai = yes
              }
            }
            AND = {
              tag = NZM # Nazmani
              ai = yes
              NTV = {
                ai = yes
              }
              AMK = {
                ai = no
              }
            }
            AND = {
              tag = NZM # Nazmani
              ai = yes
              NTV = {
                ai = no
              }
              AMK = {
                ai = yes
              }
            }
            AND = {
              tag = NZM # Nazmani
              ai = no
              NTV = {
                ai = yes
              }
              AMK = {
                ai = yes
              }
            }

          }
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = NTV # Who the current scope makes subject
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = AMK # Who the current scope makes subject
        }
      }

      if = {
        limit = {
          AND = {
            tag = NTV # Natha 'vor
            ai = no
            NZM = {
              ai = yes
            }
            AMK = {
              ai = yes
            }
          }
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = NZM # Who the current scope makes subject
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = AMK # Who the current scope makes subject
        }
      }

      if = {
        limit = {
          AND = {
            tag = AMK # Nazmani
            ai = no
            NTV = {
              ai = yes
            }
            NZM = {
              ai = yes
            }
          }
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = NTV # Who the current scope makes subject
        }
        create_subject = {
          # Used to create subjects not covered by other effects
          subject_type = lesser_bloodmother # Found in common / subject_types / 00_ subject_types.txt
          subject = NZM # Who the current scope makes subject
        }
      }

    }
  }

  option = {
    name = wwu_nazmir.1.op1
    custom_tooltip = event_1_tooltip
    hidden_effect = {
      set_country_flag = first_blood_matron
    }
  }
}

# An start event that appears after built totem
country_event = {
  id = wwu_nazmir.2
  title = wwu_nazmir.2.title
  desc = wwu_nazmir.2.desc
  picture = NAZMIR_2_eventPicture

  is_triggered_only = yes

  immediate = {
    capital_scope = {
      remove_province_triggered_modifier = blood_totem_building_province
    }
  }
  option = {
    name = wwu_nazmir.2.op1
    custom_tooltip = event_2_tooltip
    capital_scope = {
      add_province_triggered_modifier = blood_totem_province
    }
    hidden_effect = {
      random_easy_sacrificial = yes
      random_medium_sacrificial = yes
      random_hard_sacrificial = yes
    }
  }
}

country_event = {
  id = wwu_nazmir.3
  title = wwu_nazmir.3.title
  desc = wwu_nazmir.3.desc
  picture = FUNGARIAN_1_eventPicture

  is_triggered_only = yes

  option = {
    name = wwu_nazmir.3.op1
    add_years_of_owned_provinces_manpower = {
      years = 5
      trigger = {
        has_province_modifier = zandalar_fungarian_bad
      }
      custom_tooltip = zandalar_fungarian_exploit_province_b
    }
    custom_tooltip = event_3_tooltip_a


    hidden_effect = {
      add_country_modifier = {
        name = nazmir_fungarian_cd
        duration = 9125
      }
      set_country_flag = nazmir_fungarian_3_a
      if = {
        limit = {
          any_owned_province = {
            OR = {
              has_province_modifier = zandalar_fungarian_bad
              has_province_modifier = zandalar_trap_5
            }
          }
        }
        every_owned_province = {
          limit = {
            OR = {
              has_province_modifier = zandalar_fungarian_bad
              has_province_modifier = zandalar_trap_5
            }
          }
          remove_province_modifier = zandalar_fungarian_bad
          remove_province_modifier = zandalar_trap_5
          add_province_modifier = {
            name = zandalar_fungarian_bad
            duration = -1
          }
        }
      }
      if = {
        limit = {
          any_owned_province = {
            has_province_modifier = zandalar_fungarian_bad
          }
        }
        every_owned_province = {
          limit = {
            has_province_modifier = zandalar_fungarian_bad
          }
          add_province_modifier = {
            name = zandalar_fungarian_bad_bad
            duration = 1825
          }
        }
      }

    }

  }

  option = {
    name = wwu_nazmir.3.op2
    create_general = {
      name = "Deadrot Fungalmancer"
      tradition = 80
      culture = culture_fungarian
    }
    2723 = {
      add_province_modifier = {
        name = zandalar_fungarian_good
        duration = -1
      }
    }
    custom_tooltip = event_3_tooltip_b

    hidden_effect = {
      add_country_modifier = {
        name = nazmir_fungarian_cd
        duration = 9125
      }
      set_country_flag = nazmir_fungarian_3_b
      if = {
        limit = {
          any_owned_province = {
            OR = {
              has_province_modifier = zandalar_fungarian_bad
              has_province_modifier = zandalar_trap_5
            }
          }
        }
        every_owned_province = {
          limit = {
            OR = {
              has_province_modifier = zandalar_fungarian_bad
            }
          }
          remove_province_modifier = zandalar_fungarian_bad
        }
        every_owned_province = {
          limit = {
            OR = {
              has_province_modifier = zandalar_trap_5
            }
          }
          remove_province_modifier = zandalar_trap_5
        }
      }
    }

  }
}


country_event = {
  id = wwu_nazmir.4
  title = wwu_nazmir.4.title
  desc = wwu_nazmir.4.desc
  picture = FUNGARIAN_1_eventPicture

  is_triggered_only = yes

  trigger = {
    any_owned_province = {
      OR = {
        has_province_modifier = zandalar_fungarian_bad
        has_province_modifier = zandalar_fungarian_good
      }
    }
    OR = {
      has_country_flag = nazmir_fungarian_3_a
      has_country_flag = nazmir_fungarian_3_b
    }
    NOT = {
      has_country_modifier = nazmir_fungarian_cd
    }
    owns = 2723
  }

  option = {
    name = wwu_nazmir.4.op1
    if = {
      limit = {
        has_country_flag = nazmir_fungarian_3_a
      }
      add_years_of_owned_provinces_manpower = {
        years = 5
        trigger = {
          has_province_modifier = zandalar_fungarian_bad
        }
        custom_tooltip = zandalar_fungarian_exploit_province_b
      }
      hidden_effect = {
        every_owned_province = {
          limit = {
            has_province_modifier = zandalar_fungarian_bad
          }
          add_province_modifier = {
            name = zandalar_fungarian_bad_bad
            duration = 1825
          }
        }
      }

    }
    hidden_effect = {
      add_country_modifier = {
        name = nazmir_fungarian_cd
        duration = 9125
      }
    }
    if = {
      limit = {
        has_country_flag = nazmir_fungarian_3_b
      }
      if = {
        limit = {
          2723 = {
            development = 5
            NOT = {
              development = 10
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 10
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 10
            NOT = {
              development = 15
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 20
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 15
            NOT = {
              development = 20
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 30
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 20
            NOT = {
              development = 25
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 40
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 25
            NOT = {
              development = 30
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 50
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 30
            NOT = {
              development = 35
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 60
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 35
            NOT = {
              development = 40
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 70
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 40
            NOT = {
              development = 45
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 80
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 45
            NOT = {
              development = 50
            }
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 90
          culture = culture_fungarian
        }

      }
      if = {
        limit = {
          2723 = {
            development = 50
          }
        }
        create_general = {
          name = "Deadrot Fungalmancer"
          tradition = 100
          culture = culture_fungarian
        }

      }
    }

  }
}

country_event = {
  id = wwu_nazmir.5
  title = wwu_nazmir.5.title
  desc = wwu_nazmir.5.desc
  picture = NAZMIR_3_eventPicture

  is_triggered_only = yes

  trigger = {
    check_variable = {
      which = nazmir_expedition
      value = 1
    }
    any_province = {
      colonysize = 50
      region = region_nazmir
    }
    NOT = {
      has_country_flag = event_nazmir_5_open
    }
  }


  immediate = {
    hidden_effect = {
      set_country_flag = event_nazmir_5_open
    }
  }

  option = {
    name = wwu_nazmir.5.op1
    country_event = {
      id = wwu_nazmir.6
    }
    custom_tooltip = event_5_tooltip_a
    add_adm_power = -25
    add_dip_power = -25
    add_mil_power = -25
    add_manpower = -2
    hidden_effect = {

      set_country_flag = event_nazmir_5_extra
    }
  }

  option = {
    name = wwu_nazmir.5.op2
    country_event = {
      id = wwu_nazmir.6
    }


  }
}

country_event = {
  id = wwu_nazmir.6
  title = wwu_nazmir.6.title
  desc = wwu_nazmir.6.desc
  picture = NAZMIR_3_eventPicture

  is_triggered_only = yes

  option = {
    name = wwu_nazmir.6.op1
    region_nazmir = {
      limit = {
        OR = {
          colonysize = 50
          owned_by = ROOT
        }
        has_province_modifier = zandalar_trap_3
      }
      decolonize = yes
      cede_province = ROOT
      add_core = ROOT
      change_culture = ROOT
      change_religion = ROOT
      change_trade_goods = resource_oil
      if = {
        limit = {
          has_province_modifier = zandalar_trap_3
        }
        remove_province_modifier = zandalar_trap_3
        add_province_modifier = {
          name = zandalar_fungarian_bad
          duration = 9125
          desc = zandalar_fungarian_bad_desc
        }
      }
      if = {
        limit = {
          ROOT = {
            has_country_flag = event_nazmir_5_extra
          }
        }
        add_province_modifier = {
          name = nazmir_expedition_size
          duration = -1
        }
      }
    }



    add_treasury = -75
    add_adm_power = -25
    add_dip_power = -25
    add_mil_power = -25

    hidden_effect = {
      change_variable = {
        which = nazmir_expedition
        value = -1
      }
      clr_country_flag = event_nazmir_5_open
      clr_country_flag = event_nazmir_5_extra
    }
  }

  option = {
    name = wwu_nazmir.6.op2
    region_nazmir = {
      limit = {
        OR = {
          colonysize = 50
          owned_by = ROOT
        }
        has_province_modifier = zandalar_trap_3
      }
      decolonize = yes
      cede_province = ROOT
      add_core = ROOT
      change_culture = ROOT
      change_religion = ROOT
      change_trade_goods = resource_artifacts
      if = {
        limit = {
          has_province_modifier = zandalar_trap_3
        }
        remove_province_modifier = zandalar_trap_3
        add_province_modifier = {
          name = zandalar_fungarian_bad
          duration = 9125
          desc = zandalar_fungarian_bad_desc
        }
      }
      if = {
        limit = {
          ROOT = {
            has_country_flag = event_nazmir_5_extra
          }
        }
        add_province_modifier = {
          name = nazmir_expedition_size
          duration = -1
        }
      }
    }


    add_treasury = -50
    add_adm_power = -10
    add_dip_power = -10
    add_mil_power = -10

    hidden_effect = {
      change_variable = {
        which = nazmir_expedition
        value = -1
      }
      clr_country_flag = event_nazmir_5_open
      clr_country_flag = event_nazmir_5_extra
    }
  }

  option = {
    name = wwu_nazmir.6.op3
    region_nazmir = {
      limit = {
        OR = {
          colonysize = 50
          owned_by = ROOT
        }
        has_province_modifier = zandalar_trap_3
      }
      decolonize = yes
      cede_province = ROOT
      add_core = ROOT
      change_culture = ROOT
      change_religion = ROOT
      change_trade_goods = resource_fossils
      if = {
        limit = {
          has_province_modifier = zandalar_trap_3
        }
        remove_province_modifier = zandalar_trap_3
        add_province_modifier = {
          name = zandalar_fungarian_bad
          duration = 9125
          desc = zandalar_fungarian_bad_desc
        }
      }
      if = {
        limit = {
          ROOT = {
            has_country_flag = event_nazmir_5_extra
          }
        }
        add_province_modifier = {
          name = nazmir_expedition_size
          duration = -1
        }
      }
    }
    add_treasury = -25

    hidden_effect = {
      change_variable = {
        which = nazmir_expedition
        value = -1
      }
      clr_country_flag = event_nazmir_5_open
      clr_country_flag = event_nazmir_5_extra
    }
  }

  option = {
    name = wwu_nazmir.6.op4
    region_nazmir = {
      limit = {
        OR = {
          colonysize = 50
          owned_by = ROOT
        }
        has_province_modifier = zandalar_trap_3
      }
      decolonize = yes
      cede_province = ROOT
      add_core = ROOT
      change_culture = ROOT
      change_religion = ROOT
      change_trade_goods = resource_common_wood
      if = {
        limit = {
          has_province_modifier = zandalar_trap_3
        }
        remove_province_modifier = zandalar_trap_3
        add_province_modifier = {
          name = zandalar_fungarian_bad
          duration = 9125
          desc = zandalar_fungarian_bad_desc
        }
      }
      if = {
        limit = {
          ROOT = {
            has_country_flag = event_nazmir_5_extra
          }
        }
        add_province_modifier = {
          name = nazmir_expedition_size
          duration = -1
        }
      }
    }


    hidden_effect = {
      change_variable = {
        which = nazmir_expedition
        value = -1
      }
      clr_country_flag = event_nazmir_5_open
      clr_country_flag = event_nazmir_5_extra
    }
  }
}

country_event = {
  id = wwu_nazmir.7
  title = wwu_nazmir.7.title
  desc = wwu_nazmir.7.desc
  picture = NAZMIR_3_eventPicture

  is_triggered_only = yes

  trigger = {
    has_country_flag = event_nazmir_7
    NOT = {
      has_country_modifier = nazmir_blood_cycle_cd
    }
  }

  immediate = {
    hidden_effect = {
      add_country_modifier = {
        name = nazmir_blood_cycle_cd
        duration = 7300
      }
    }
  }

  option = {
    name = wwu_nazmir.7.op1

    if = {
      limit = {
        check_variable = {
          which = nazmir_blood_cycle
          value = 1
        }
        NOT = {
          check_variable = {
            which = nazmir_blood_cycle
            value = 2
          }
        }
      }
      blood_add_1 = yes
    }

    if = {
      limit = {
        check_variable = {
          which = nazmir_blood_cycle
          value = 2
        }
        NOT = {
          check_variable = {
            which = nazmir_blood_cycle
            value = 3
          }
        }
      }
      blood_add_2 = yes
    }

    if = {
      limit = {
        check_variable = {
          which = nazmir_blood_cycle
          value = 3
        }
        NOT = {
          check_variable = {
            which = nazmir_blood_cycle
            value = 4
          }
        }
      }
      blood_add_3 = yes
    }


  }
}