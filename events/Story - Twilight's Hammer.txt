namespace = wwu_twilight_hammer

# Twilight Infiltration in Silithus
country_event = {
	id = wwu_twilight_hammer.1
	title = wwu_twilight_hammer.1.title
	desc = wwu_twilight_hammer.1.desc
	picture = TWILIGHT_SUMMONER_eventPicture

	fire_only_once = yes
    major = yes
    
	trigger = {
        OR = {
            tag = A43
            AND = {
                NOT = { exists = A43 }
                ai = no
                has_country_flag = host_player
            }
        }
        
        # 50 years after Orcish invasion
        had_global_flag = {
            flag = orcish_horde_established
            days = 18250
        }
	}
	
	mean_time_to_happen = { 
        months = 320
    }
    
	option = {
		name = wwu_twilight_hammer.1.option.a    
        
        random_province = {
            limit = {
                region = region_silithus
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_silithus
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_silithus
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_silithus
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
    }
}

# Twilight Infiltration in Blackfathom Deeps
country_event = {
	id = wwu_twilight_hammer.2
	title = wwu_twilight_hammer.2.title
	desc = wwu_twilight_hammer.2.desc
	picture = TWILIGHT_DARKMENDER_eventPicture

	fire_only_once = yes
    major = yes
    
	trigger = { 
        OR = {
            tag = A43
            AND = {
                NOT = { exists = A43 }
                ai = no
                has_country_flag = host_player
            }
        }
        
        # 50 years after Orcish invasion
        had_global_flag = {
            flag = orcish_horde_established
            days = 18250
        }
	}
	
	mean_time_to_happen = { 
        months = 320
    }
    
	option = {
		name = wwu_twilight_hammer.2.option.a    
        
        area_blackfathom_deep = {
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
    }
}

# Twilight Infiltration in Azshara
country_event = {
	id = wwu_twilight_hammer.3
	title = wwu_twilight_hammer.3.title
	desc = wwu_twilight_hammer.3.desc
	picture = TWILIGHT_GEOMANCER_eventPicture

	fire_only_once = yes
    major = yes
    
	trigger = { 
        OR = {
            tag = A43
            AND = {
                NOT = { exists = A43 }
                ai = no
                has_country_flag = host_player
            }
        }
        
        # 50 years after Orcish invasion
        had_global_flag = {
            flag = orcish_horde_established
            days = 18250
        }
	}
	
	mean_time_to_happen = { 
        months = 320
    }
    
	option = {
		name = wwu_twilight_hammer.3.option.a    
        
        random_province = {
            limit = {
                region = region_azshara
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_azshara
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_azshara
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        random_province = {
            limit = {
                region = region_azshara
            }
            
            if = {
                limit = {
                    ROOT = {
                        tag = A43
                        ai = no
                    }
                }
                cede_province = A43
            }
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
    }
}

# Bastion of Twilight
country_event = {
	id = wwu_twilight_hammer.10
	title = wwu_twilight_hammer.10.title
	desc = wwu_twilight_hammer.10.desc
	picture = HAMMER_OF_TWILIGHT_eventPicture

	fire_only_once = yes
    major = yes
    
	trigger = { 
        OR = {
            tag = A43
            AND = {
                NOT = { exists = A43 }
                ai = no
                has_country_flag = host_player
            }
        }
        
        # 100 years after Orcish invasion
        had_global_flag = {
            flag = orcish_horde_established
            days = 36500
        }
	}
	
	mean_time_to_happen = { 
        months = 320
    }
    
	option = {
		name = wwu_twilight_hammer.10.option.a    
        
        area_bastion_of_twilight = {
            cede_province = A43
            add_core = A43
            change_culture = culture_twilight_cultist
            change_religion = twilight_cult
        }
        
        if = {
            limit = {
                ai = no
            }
            
            set_capital = 710
        }
        
        if = {
            limit = {
                NOT = { religion = twilight_cult }
            }
            
            change_religion = twilight_cult
        }
        
        if = {
            limit = {
                NOT = { primary_culture = culture_twilight_cultist }
            }
            
            change_culture = culture_twilight_cultist
        }
        
        change_government = theocracy
        add_government_reform = theocracy_reform
    
        define_ruler = {
            name = "Cho'gall" 
            dynasty = "of Highmaul" 
            adm = 6
            dip = 6
            mil = 6
            min_age = 100
            max_age = 200
        }
        
        set_ruler_flag = is_immortal
        set_ruler_flag = mage_personality
        set_ruler_flag = ruler_portrait_chogall
        
        setup_spellcaster_history = {
            APTITUDE = 4
            FINESSE = 4
            CONCENTRATION = 4
            MANA = 5
            shadow = yes
        }
    }
}

# Twilight Infiltration Manager
country_event = {
	id = wwu_twilight_hammer.20
	title = wwu_twilight_hammer.20.title
	desc = wwu_twilight_hammer.20.desc
	picture = TWILIGHT_DARKMENDER_eventPicture

    hidden = yes
    
	trigger = { 
        tag = A43
        religion = twilight_cult
        
        # 50 years after Orcish invasion
        had_global_flag = {
            flag = orcish_horde_established
            days = 18250
        }
	}
	
	mean_time_to_happen = { 
        months = 240
    }
    
	option = {
		name = wwu_twilight_hammer.20.option.a    
        
        random_province = {
            limit = {
                is_azeroth_province = yes
                is_empty = no
                is_capital = no
                NOT = { religion = twilight_cult }
                owner = {
                    NOT = { religion = twilight_cult }
                }
            }
            
            province_event = { id = wwu_twilight_hammer.21 }
        }
    }
}

# Twilight Infiltration in PROVINCE
province_event = {
	id = wwu_twilight_hammer.21
	title = wwu_twilight_hammer.21.title
	desc = wwu_twilight_hammer.21.desc
	picture = TWILIGHT_DARKMENDER_eventPicture
    goto = target_province
    
    hidden = yes
    is_triggered_only = yes
	
	mean_time_to_happen = { 
        days = 1
    }
    
    immediate = {
        hidden_effect = {
            save_event_target_as = target_province
        }
    }
    
	option = {
		name = wwu_twilight_hammer.21.option.a    
        
        add_mil_power = -100
        
        ai_chance = {
            factor = 0
        }
    }
    option = {
		name = wwu_twilight_hammer.21.option.b
        
        add_core = A43
        change_culture = culture_twilight_cultist
        change_religion = twilight_cult
        
        ai_chance = {
            factor = 100
        }
    }
}

