namespace = wwu_setup_worgen

# Wolf Cult
country_event = {
	id = wwu_setup_worgen.1
	title = wwu_setup_worgen.1.title
	desc = wwu_setup_worgen.1.desc
	picture = RAGING_WORGEN_eventPicture

	is_triggered_only = yes
    
	trigger = {
        has_global_flag = enable_worgen
        
        NOT = { exists = P29 } # Wolfcult
        NOT = { exists = A13 } # Shadowfang
        NOT = { has_global_flag = setup_wolf_cult }
        
        # If the player and AI own part of the area, only allow the event to fire for the player.
        if = {
            limit = {
                area_shadowfang_keep = {
                    owner = {
                        ai = no
                    }
                }
                area_shadowfang_keep = {
                    owner = {
                        ai = yes
                    }
                }
            }
            
            ai = no
        }
        
        area_shadowfang_keep = {
            owned_by = ROOT
        }
    }
    
    immediate = {
        hidden_effect = {
            set_global_flag = setup_wolf_cult
        }
    }
    
    mean_time_to_happen = {
		days = 1
	}

	option = {
		name = wwu_setup_worgen.1.option.a
        
        spawn_nation_by_area = { area = area_shadowfang_keep tag = P29 culture = culture_wolfcult religion = shadow }
	}
    option = {
		name = wwu_setup_worgen.1.option.b
        
        add_dip_power = -100
        
        custom_tooltip = PARTIAL_SETUP_TT
        
        spawn_nation_by_area_conditional = { area = area_shadowfang_keep tag = P29 culture = culture_wolfcult religion = shadow }
	}
    option = {
		name = wwu_setup_worgen.1.option.c
        
        add_mil_power = -250
        
        spawn_nation_by_area_core_only = { area = area_shadowfang_keep tag = P29 }
	}
    
    after = {
        P29 = {
            country_event = { id = wwu_setup_worgen.2 days = 3 }
        }
    }
}

# Wolf Cult
country_event = {
	id = wwu_setup_worgen.2
	title = wwu_setup_worgen.2.title
	desc = wwu_setup_worgen.2.desc
	picture = RAGING_WORGEN_eventPicture

	is_triggered_only = yes
    
    mean_time_to_happen = {
		days = 1
	}

	option = {
		name = wwu_setup_worgen.2.option.a
        
        # This prevents the normal succession event from occuring
        hidden_effect = {
            set_country_flag = skip_next_succession_event
        }
        
        define_ruler = {
            name = "Alpha" 
            dynasty = "Prime" 
            adm = 3
            dip = 2
            mil = 6
        }
        
        add_nation_boost_2 = yes
	}
    
    after = {
        hidden_effect = {
            reveal_all_discovery = yes
        }
    }
}

# Nightbane
country_event = {
	id = wwu_setup_worgen.3
	title = wwu_setup_worgen.3.title
	desc = wwu_setup_worgen.3.desc
	picture = RAGING_WORGEN_eventPicture

	is_triggered_only = yes
    
	trigger = {
        had_global_flag = {
            flag = enable_worgen
            days = 18250
        }
        
        NOT = { exists = P31 }
        NOT = { has_global_flag = setup_nightbane }
        
        # If the player and AI own part of the area, only allow the event to fire for the player.
        if = {
            limit = {
                OR = {
                    AND = {
                        1057 = {
                            owner = {
                                ai = no
                            }
                        }
                        OR = {
                            970 = {
                                owner = {
                                    ai = yes
                                }
                            }
                            586 = {
                                owner = {
                                    ai = yes
                                }
                            }
                        }
                    }
                    AND = {
                        970 = {
                            owner = {
                                ai = no
                            }
                        }
                        OR = {
                            1057 = {
                                owner = {
                                    ai = yes
                                }
                            }
                            586 = {
                                owner = {
                                    ai = yes
                                }
                            }
                        }
                    }
                    AND = {
                        586 = {
                            owner = {
                                ai = no
                            }
                        }
                        OR = {
                            970 = {
                                owner = {
                                    ai = yes
                                }
                            }
                            1057 = {
                                owner = {
                                    ai = yes
                                }
                            }
                        }
                    }
                }
            }
            
            ai = no
        }
        
        OR = {
            owns = 1057
            owns = 970
            owns = 586
        }
    }
    
    immediate = {
        hidden_effect = {
            set_global_flag = setup_nightbane
        }
    }
    
    mean_time_to_happen = {
		days = 1
	}

	option = {
		name = wwu_setup_worgen.3.option.a
        
        spawn_nation_by_province = { province = 1057 tag = P31 culture = culture_wolfcult religion = shadow }
        spawn_nation_by_province = { province = 970 tag = P31 culture = culture_wolfcult religion = shadow }
        spawn_nation_by_province = { province = 586 tag = P31 culture = culture_wolfcult religion = shadow }
	}
    option = {
		name = wwu_setup_worgen.3.option.b
        
        add_dip_power = -100
        
        custom_tooltip = PARTIAL_SETUP_TT
        
        spawn_nation_by_province_conditional = { province = 1057 tag = P31 culture = culture_wolfcult religion = shadow }
        spawn_nation_by_province_conditional = { province = 970 tag = P31 culture = culture_wolfcult religion = shadow }
        spawn_nation_by_province_conditional = { province = 586 tag = P31 culture = culture_wolfcult religion = shadow }
	}
    option = {
		name = wwu_setup_worgen.3.option.c
        
        add_mil_power = -250
        
        spawn_nation_by_province_core_only = { province = 1057 tag = P31 }
        spawn_nation_by_province_core_only = { province = 970 tag = P31 }
        spawn_nation_by_province_core_only = { province = 586 tag = P31 }
	}
    
    after = {
        P31 = {
            country_event = { id = wwu_setup_worgen.4 days = 3 }
        }
    }
}

# Nightbane
country_event = {
	id = wwu_setup_worgen.4
	title = wwu_setup_worgen.4.title
	desc = wwu_setup_worgen.4.desc
	picture = RAGING_WORGEN_eventPicture

	is_triggered_only = yes
    
    mean_time_to_happen = {
		days = 1
	}

	option = {
		name = wwu_setup_worgen.4.option.a
        
        # This prevents the normal succession event from occuring
        hidden_effect = {
            set_country_flag = skip_next_succession_event
        }
        
        define_ruler = {
            name = "Gervase" 
            dynasty = "the Nightbane" 
            adm = 3
            dip = 3
            mil = 6
        }
        
        add_nation_boost_2 = yes
	}
    
    after = {
        hidden_effect = {
            reveal_all_discovery = yes
        }
    }
}
